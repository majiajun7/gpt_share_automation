from flask import jsonify, g, request, current_app
from flask_login import login_required
from werkzeug.utils import secure_filename
from werkzeug.datastructures import FileStorage
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils import secure_filename
from werkzeug.utils
from werkzeug.utils
from werkzeug.utils
from werkzeug.utils
from werkzeug.utils
from werkzeug.utils
from werkzeug.utils
from werkzeug.utils
from werkzeug.utils
from werkzeug.utils
from werkzeug.utils
from werkzeug.utils
from werkzeug.utils
from werkzeug.utils
from werkzeug.utils
from werkzeug.utils
from werkzeug.utils
from werkzeug.utils
from werkzeug.utils
from werkzeug.utils
from werkzeug.utils
from werkzeug.utils
from werkzeug.utils
from werkzeug.utils
from werkzeug.utils
from werkzeug.utils
from werkzeug.utils
from werkzeug.utils
from werkzeug.utils
from werkzeug.utils
from werkzeug.utils
from werkzeug.utils
from werkzeug.utils
from werkzeug.utils
from werkzeug.utils
from werkzeug.utils
from werkzeug.utils
from werkzeug.utils
from werkzeug.utils
from werkzeug.utils
from werkzeug.utils
from werkzeug.utils
from werkzeug.utils
from werkzeug.utils
from werkzeug.utils
from werkzeug.utils
from werkzeug.utils
from werkzeug.utils
from werkzeug.utils
from werkzeug.utils
from werkzeug.utils
from werkzeug.utils
from werkzeug.utils
from werkzeug.utils
from werkzeug.utils
from werkzeug.utils
from werkzeug.utils
from werkzeug.utils
from werkzeug.utils
from werkzeug.utils
from werkzeug.utils
from werkzeug.utils
from werkzeug.utils
from werkzeug.utils
from werkzeug.utils
from werkzeug.utils
from werkzeug.utils
from werkzeug.utils
from werkzeug.utils
from werkzeug.utils
from werkzeug.utils
from werkzeug.utils
from werkzeug.utils
from werkzeug.utils
from werkzeug.utils
from werkzeug.utils
from werkzeug.utils
from werkzeug.utils
from werkzeug.utils
from werkzeug.utils
from werkzeug.utils
from werkzeug.utils
from werkzeug.utils
from werkzeug.utils
from werkzeug.utils
from werkzeug.utils
from werkzeug.utils
from werkzeug.utils
from werkzeug.utils
from werkzeug.utils
from werkzeug.utils
from werkzeug.utils
from werkzeug.utils
from werkzeug.utils
from werkzeug.utils
from werkzeug.utils
from werkzeug.utils
from werkzeug.utils
from werkzeug.utils
from werkzeug.utils
from werkzeug.utils
from werkzeug.utils
from werkzeug.utils
from werkzeug.utils
from werkzeug.utils
from werkzeug.utils
from werkzeug.utils
from werkzeug.utils
from werkzeug.utils
from werkzeug.utils
from werkzeug.utils
from werkzeug.utils
from werkzeug.utils
from werkzeug.utils
from werkzeug.utils
from werkzeug.utils
from werkzeug.utils
from werkzeug.utils
from werkzeug.utils
from werkzeug.utils
from werkzeug.utils
from werkzeug.utils
from werkzeug.utils
from werkzeug.utils
from werkzeug.utils
from werkzeug.utils
from werkzeug.utils
from werkzeug.utils
from werkzeug.utils
from werkzeug.utils
from werkzeug.utils
from werkzeug.utils
from werkzeug.utils
from werkzeug.utils
from werkzeug.utils
from werkzeug.utils
from werkzeug.utils
from werkzeug.utils
from werkzeug.utils
from werkzeug.utils
from werkzeug.utils
from werkzeug.utils
from werkzeug.utils
from werkzeug.utils
from werkzeug.utils
from werkzeug.utils
from werkzeug.utils
from werkzeug.utils
from werkzeug.utils
from werkzeug.utils
from werkzeug.utils
from werkzeug.utils
from werkzeug.utils
from werkzeug.utils
from werkzeug.utils
from werkzeug.utils
from werkzeug.utils
from werkzeug.utils
from werkzeug.utils
from werkzeug.utils
from werkzeug.utils
from werkzeug.utils
from werkzeug.utils
from werkzeug.utils
from werkzeug.utils
from werkzeug.utils
from werkzeug.utils
from werkzeug.utils
from werkzeug.utils
from werkzeug.utils
from werkzeug.utils
from werkzeug.utils
from werkzeug.utils
from werkzeug.utils
from werkzeug.utils
from werkzeug.utils
from werkzeug.utils
from werkzeug.utils
from werkzeug.utils
from werkzeug.utils
from werkzeug.utils
from werkzeug.utils
from werkzeug.utils
from werkzeug.utils
from werkzeug.utils
from werkzeug.utils
from werkzeug.utils
from werkzeug.utils
from werkzeug.utils
from werkzeug.utils
from werkzeug.utils
from werkzeug.utils
from werkzeug.utils
from werkzeug.utils
from werkzeug.utils
from werkzeug.utils
from werkzeug.utils
from werkzeug.utils
from werkzeug.utils
from werkzeug.utils
from werkzeug.utils
from werkzeug.utils
from werkzeug.utils
from werkzeug.utils
from werkzeug.utils
from werkzeug.utils
from werkzeug.utils
from werkzeug.utils
from werkzeug.utils
from werkzeug.utils
from werkzeug.utils
from werkzeug.utils
from werkzeug.utils
from werkzeug.utils
from werkzeug.utils
from werkzeug.utils
from werkzeug.utils
from werkzeug.utils
from werkzeug.utils
from werkzeug.utils
from werkzeug.utils
from werkzeug.utils
from werkzeug.utils
from werkzeug.utils
from werkzeug.utils
from werkzeug.utils
from werkzeug.utils
from werkzeug.utils
from werkzeug.utils
from werkzeug.utils
from werkzeug.utils
from werkzeug.utils
from werkzeug.utils
from werkzeug.utils
from werkzeug.utils
from werkzeug.utils
from werkzeug.utils
from werkzeug.utils
from werkzeug.utils
from werkzeug.utils
from werkzeug.utils
from werkzeug.utils
from werkzeug.utils
from werkzeug.utils
from werkzeug.utils
from werkzeug.utils
from werkzeug.utils
from werkzeug.utils
from werkzeug.utils
from werkzeug.utils
from werkzeug.utils
from werkzeug.utils
from werkzeug.utils
from werkzeug.utils
from werkzeug.utils
from werkzeug.utils
from werkzeug.utils
from werkzeug.utils
from werkzeug.utils
from werkzeug.utils
from werkzeug.utils
from werkzeug.utils
from werkzeug.utils
from werkzeug.utils
from werkzeug.utils
from werkzeug.utils
from werkzeug.utils
from werkzeug.utils
from werkzeug.utils
from werkzeug.utils
from werkzeug.utils
from werkzeug.utils
from werkzeug.utils
from werkzeug.utils
from werkzeug.utils
from werkzeug.utils
from werkzeug.utils
from werkzeug.utils
from werkzeug.utils
from werkzeug.utils
from werkzeug.utils
from werkzeug.utils
from werkzeug.utils
from werkzeug.utils
from werkzeug.utils
from werkzeug.utils
from werkzeug.utils
from werkzeug.utils
from werkzeug.utils
from werkzeug.utils
from werkzeug.utils
from werkzeug.utils
from werkzeug.utils
from werkzeug.utils
from werkzeug.utils
from werkzeug.utils
from werkzeug.utils
from werkzeug.utils
from werkzeug.utils
from werkzeug.utils
from werkzeug.utils
from werkzeug.utils
from werkzeug.utils
from werkzeug.utils
from werkzeug.utils
from werkzeug.utils
from werkzeug.utils
from werkzeug.utils
from werkzeug.utils
from werkzeug.utils
from werkzeug.utils
from werkzeug.utils
from werkzeug.utils
from werkzeug.utils
from werkzeug.utils
from werkzeug.utils
from werkzeug.utils
from werkzeug.utils
from werkzeug.utils
from werkzeug.utils
from werkzeug.utils
from werkzeug.utils
from werkzeug.utils
from werkzeug.utils
from werkzeug.utils
from werkzeug.utils
from werkzeug.utils
from werkzeug.utils
from werkzeug.utils
from werkzeug.utils
from werkzeug.utils
from werkzeug.utils
from werkzeug.utils
from werkzeug.utils
from werkzeug.utils
from werkzeug.utils
from werkzeug.utils
from werkzeug.utils
from werkzeug.utils
from werkzeug.utils
from werkzeug.utils
from werkzeug.utils
from werkzeug.utils
from werkzeug.utils
from werkzeug.utils
from werkzeug.utils
from werkzeug.utils
from werkzeug.utils
from werkzeug.utils
from werkzeug.utils
from werkzeug.utils
from werkzeug.utils
from werkzeug.utils
from werkzeug.utils
from werkzeug.utils
from werkzeug.utils
from werkzeug.utils
from werkzeug.utils
from werkzeug.utils
from werkzeug.utils
from werkzeug.utils
from werkzeug.utils
from werkzeug.utils
from werkzeug.utils
from werkzeug.utils
from werkzeug.utils
from werkzeug.utils
from werkzeug.utils
from werkzeug.utils
from werkzeug.utils
from werkzeug.utils
from werkzeug.utils
from werkzeug.utils
from werkzeug.utils
from werkzeug.utils
from werkzeug.utils
from werkzeug.utils
from werkzeug.utils
from werkzeug.utils
from werkzeug.utils
from werkzeug.utils
from werkzeug.utils
from werkzeug.utils
from werkzeug.utils
from werkzeug.utils
from werkzeug.utils
from werkzeug.utils
from werkzeug.utils
from werkzeug.utils
from werkzeug.utils
from werkzeug.utils
from werkzeug.utils
from werkzeug.utils
from werkzeug.utils
from werkzeug.utils
from werkzeug.utils
from werkzeug.utils
from werkzeug.utils
from werkzeug.utils
from werkzeug.utils
from werkzeug.utils
from werkzeug.utils
from werkzeug.utils
from werkzeug.utils
from werkzeug.utils
from werkzeug.utils
from werkzeug.utils
from werkzeug.utils
from werkzeug.utils
from werkzeug.utils
from werkzeug.utils
from werkzeug.utils
from werkzeug.utils
from werkzeug.utils
from werkzeug.utils
from werkzeug.utils
from werkzeug.utils
from werkzeug.utils
from werkzeug.utils
from werkzeug.utils
from werkzeug.utils
from werkzeug.utils
from werkzeug.utils
from werkzeug.utils
from werkzeug.utils
from werkzeug.utils
from werkzeug.utils
from werkzeug.utils
from werkzeug.utils
from werkzeug.utils
from werkzeug.utils
from werkzeug.utils
from werkzeug.utils
from werkzeug.utils
from werkzeug.utils
from werkzeug.utils
from werkzeug.utils
from werkzeug.utils
from werkzeug.utils
from werkzeug.utils
from werkzeug.utils
from werkzeug.utils
from werkzeug.utils
from werkzeug.utils
from werkzeug.utils
from werkzeug.utils
from werkzeug.utils
from werkzeug.utils
from werkzeug.utils
from werkzeug.utils
from werkzeug.utils
from werkzeug.utils
from werkzeug.utils
from werkzeug.utils
from werkzeug.utils
from werkzeug.utils
from werkzeug.utils
from werkzeug.utils
from werkzeug.utils
from werkzeug.utils
from werkzeug.utils
from werkzeug.utils
from werkzeug.utils
from werkzeug.utils
from werkzeug.utils
from werkzeug.utils
from werkzeug.utils
from werkzeug.utils
from werkzeug.utils
from werkzeug.utils
from werkzeug.utils
from werkzeug.utils
from werkzeug.utils
from werkzeug.utils
from werkzeug.utils
from werkzeug.utils
from werkzeug.utils
from werkzeug.utils
from werkzeug.utils
from werkzeug.utils
from werkzeug.utils
from werkzeug.utils
from werkzeug.utils
from werkzeug.utils
from werkzeug.utils
from werkzeug.utils
from werkzeug.utils
from werkzeug.utils
from werkzeug.utils
from werkzeug.utils
from werkzeug.utils
from werkzeug.utils
from werkzeug.utils
from werkzeug.utils
from werkzeug.utils
from werkzeug.utils
from werkzeug.utils
from werkzeug.utils
from werkzeug.utils
from werkzeug.utils
from werkzeug.utils
from werkzeug.utils
from werkzeug.utils
from werkzeug.utils
from werkzeug.utils
from werkzeug.utils
from werkzeug.utils
from werkzeug.utils
from werkzeug.utils
from werkzeug.utils
from werkzeug.utils
from werkzeug.utils
from werkzeug.utils
from werkzeug.utils
from werkzeug.utils
from werkzeug.utils
from werkzeug.utils
from werkzeug.utils
from werkzeug.utils
from werkzeug.utils
from werkzeug.utils
from werkzeug.utils
from werkzeug.utils
from werkzeug.utils
from werkzeug.utils
from werkzeug.utils
from werkzeug.utils
from werkzeug.utils
from werkzeug.utils
from werkzeug.utils
from werkzeug.utils
from werkzeug.utils
from werkzeug.utils
from werkzeug.utils
from werkzeug.utils
from werkzeug.utils
from werkzeug.utils
from werkzeug.utils
from werkzeug.utils
from werkzeug.utils
from werkzeug.utils
from werkzeug.utils
from werkzeug.utils
from werkzeug.utils
from werkzeug.utils
from werkzeug.utils
from werkzeug.utils
from werkzeug.utils
from werkzeug.utils
from werkzeug.utils
from werkzeug.utils
from werkzeug.utils
from werkzeug.utils
from werkzeug.utils
from werkzeug.utils
from werkzeug.utils
from werkzeug.utils
from werkzeug.utils
from werkzeug.utils
from werkzeug.utils
from werkzeug.utils
from werkzeug.utils
from werkzeug.utils
from werkzeug.utils
from werkzeug.utils
from werkzeug.utils
from werkzeug.utils
from werkzeug.utils
from werkzeug.utils
from werkzeug.utils
from werkzeug.utils
from werkzeug.utils
from werkzeug.utils
from werkzeug.utils
from werkzeug.utils
from werkzeug.utils
from werkzeug.utils
from werkzeug.utils
from werkzeug.utils
from werkzeug.utils
from werkzeug.utils
from werkzeug.utils
from werkzeug.utils
from werkzeug.utils
from werkzeug.utils
from werkzeug.utils
from werkzeug.utils
from werkzeug.utils
from werkzeug.utils
from werkzeug.utils
from werkzeug.utils
from werkzeug.utils
from werkzeug.utils
from werkzeug.utils
from werkzeug.utils
from werkzeug.utils
from werkzeug.utils
from werkzeug.utils
from werkzeug.utils
from werkzeug.utils
from werkzeug.utils
from werkzeug.utils
from werkzeug.utils
from werkzeug.utils
from werkzeug.utils
from werkzeug.utils
from werkzeug.utils
from werkzeug.utils
from werkzeug.utils
from werkzeug.utils
from werkzeug.utils
from werkzeug.utils
from werkzeug.utils
from werkzeug.utils
from werkzeug.utils
from werkzeug.utils
from werkzeug.utils
from werkzeug.utils
from werkzeug.utils
from werkzeug.utils
from werkzeug.utils
from werkzeug.utils
from werkzeug.utils
from werkzeug.utils
from werkzeug.utils
from werkzeug.utils
from werkzeug.utils
from werkzeug.utils
from werkzeug.utils
from werkzeug.utils
from werkzeug.utils
from werkzeug.utils
from werkzeug.utils
from werkzeug.utils
from werkzeug.utils
from werkzeug.utils
from werkzeug.utils
from werkzeug.utils
from werkzeug.utils
from werkzeug.utils
from werkzeug.utils
from werkzeug.utils
from werkzeug.utils
from werkzeug.utils
from werkzeug.utils
from werkzeug.utils
from werkzeug.utils
from werkzeug.utils
from werkzeug.utils
from werkzeug.utils
from werkzeug.utils
from werkzeug.utils
from werkzeug.utils
from werkzeug.utils
from werkzeug.utils
from werkzeug.utils
from werkzeug.utils
from werkzeug.utils
from werkzeug.utils
from werkzeug.utils
from werkzeug.utils
from werkzeug.utils
from werkzeug.utils
from werkzeug.utils
from werkzeug.utils
from werkzeug.utils
from werkzeug.utils
from werkzeug.utils
from werkzeug.utils
from werkzeug.utils
from werkzeug.utils
from werkzeug.utils
from werkzeug.utils
from werkzeug.utils
from werkzeug.utils
from werkzeug.utils
from werkzeug.utils
from werkzeug.utils
from werkzeug.utils
from werkzeug.utils
from werkzeug.utils
from werkzeug.utils
from werkzeug.utils
from werkzeug.utils
from werkzeug.utils
from werkzeug.utils
from werkzeug.utils
from werkzeug.utils
from werkzeug.utils
from werkzeug.utils
from werkzeug.utils
from werkzeug.utils
from werkzeug.utils
from werkzeug.utils
from werkzeug.utils
from werkzeug.utils
from werkzeug.utils
from werkzeug.utils
from werkzeug.utils
from werkzeug.utils
from werkzeug.utils
from werkzeug.utils
from werkzeug.utils
from werkzeug.utils
from werkzeug.utils
from werkzeug.utils
from werkzeug.utils
from werkzeug.utils
from werkzeug.utils
from werkzeug.utils
from werkzeug.utils
from werkzeug.utils
from werkzeug.utils
from werkzeug.utils
from werkzeug.utils
from werkzeug.utils
from werkzeug.utils
from werkzeug.utils
from werkzeug.utils
from werkzeug.utils
from werkzeug.utils
from werkzeug.utils
from werkzeug.utils
from werkzeug.utils
from werkzeug.utils
from werkzeug.utils
from werkzeug.utils
from werkzeug.utils
from werkzeug.utils
from werkzeug.utils
from werkzeug.utils
from werkzeug.utils
from werkzeug.utils
from werkzeug.utils
from werkzeug.utils
from werkzeug.utils
from werkzeug.utils
from werkzeug.utils
from werkzeug.utils
from werkzeug.utils
from werkzeug.utils
from werkzeug.utils
from werkzeug.utils
from werkzeug.utils
from werkzeug.utils
from werkzeug.utils
from werkzeug.utils
from werkzeug.utils
from werkzeug.utils
from werkzeug.utils
from werkzeug.utils
from werkzeug.utils
from werkzeug.utils
from werkzeug.utils
from werkzeug.utils
from werkzeug.utils
from werkzeug.utils
from werkzeug.utils
from werkzeug.utils
from werkzeug.utils
from werkzeug.utils
from werkzeug.utils
from werkzeug.utils
from werkzeug.utils
from werkzeug.utils
from werkzeug.utils
from werkzeug.utils
from werkzeug.utils
from werkzeug.utils
from werkzeug.utils
from werkzeug.utils
from werkzeug.utils
from werkzeug.utils
from werkzeug.utils
from werkzeug.utils
from werkzeug.utils
from werkzeug.utils
from werkzeug.utils
from werkzeug.utils
from werkzeug.utils
from werkzeug.utils
from werkzeug.utils
from werkzeug.utils
from werkzeug.utils
from werkzeug.utils
from werkzeug.utils
from werkzeug.utils
from werkzeug.utils
from werkzeug.utils
from werkzeug.utils
from werkzeug.utils
from werkzeug.utils
from werkzeug.utils
from werkzeug.utils
from werkzeug.utils
from werkzeug.utils
from werkzeug.utils
from werkzeug.utils
from werkzeug.utils
from werkzeug.utils
from werkzeug.utils
from werkzeug.utils
from werkzeug.utils
from werkzeug.utils
from werkzeug.utils
from werkzeug.utils
from werkzeug.utils
from werkzeug.utils
from werkzeug.utils
from werkzeug.utils
from werkzeug.utils
from werkzeug.utils
from werkzeug.utils
from werkzeug.utils
from werkzeug.utils
from werkzeug.utils
from werkzeug.utils
from werkzeug.utils
from werkzeug.utils
from werkzeug.utils
from werkzeug.utils
from werkzeug.utils
from werkzeug.utils
from werkzeug.utils
from werkzeug.utils
from werkzeug.utils
from werkzeug.utils
from werkzeug.utils
from werkzeug.utils
from werkzeug.utils
from werkzeug.utils
from werkzeug.utils
from werkzeug.utils
from werkzeug.utils
from werkzeug.utils
from werkzeug.utils
from werkzeug.utils
from werkzeug.utils
from werkzeug.utils
from werkzeug.utils
from werkzeug.utils
from werkzeug.utils
from werkzeug.utils
from werkzeug.utils
from werkzeug.utils
from werkzeug.utils
from werkzeug.utils
from werkzeug.utils
from werkzeug.utils
from werkzeug.utils
from werkzeug.utils
from werkzeug.utils
from werkzeug.utils
from werkzeug.utils
from werkzeug.utils
from werkzeug.utils
from werkzeug.utils
from werkzeug.utils
from werkzeug.utils
from werkzeug.utils
from werkzeug.utils
from werkzeug.utils
from werkzeug.utils
from werkzeug.utils
from werkzeug.utils
from werkzeug.utils
from werkzeug.utils
from werkzeug.utils
from werkzeug.utils
from werkzeug.utils
from werkzeug.utils
from werkzeug.utils
from werkzeug.utils
from werkzeug.utils
from werkzeug.utils
from werkzeug.utils
from werkzeug.utils
from werkzeug.utils
from werkzeug.utils
from werkzeug.utils
from werkzeug.utils
from werkzeug.utils
from werkzeug.utils
from werkzeug.utils
from werkzeug.utils
from werkzeug.utils
from werkzeug.utils
from werkzeug.utils
from werkzeug.utils
from werkzeug.utils
from werkzeug.utils
from werkzeug.utils
from werkzeug.utils
from werkzeug.utils
from werkzeug.utils
from werkzeug.utils
from werkzeug.utils
from werkzeug.utils
from werkzeug.utils
from werkzeug.utils
from werkzeug.utils
from werkzeug.utils
from werkzeug.utils
from werkzeug.utils
from werkzeug.utils
from werkzeug.utils
from werkzeug.utils
from werkzeug.utils
from werkzeug.utils
from werkzeug.utils
from werkzeug.utils
from werkzeug.utils
from werkzeug.utils
from werkzeug.utils
from werkzeug.utils
from werkzeug.utils
from werkzeug.utils
from werkzeug.utils
from werkzeug.utils
from werkzeug.utils
from werkzeug.utils
from werkzeug.utils
from werkzeug.utils
from werkzeug.utils
from werkzeug.utils
from werkzeug.utils
from werkzeug.utils
from werkzeug.utils
from werkzeug.utils
from werkzeug.utils
from werkzeug.utils
from werkzeug.utils
from werkzeug.utils
from werkzeug.utils
from werkzeug.utils
from werkzeug.utils
from werkzeug.utils
from werkzeug.utils
from werkzeug.utils
from werkzeug.utils
from werkzeug.utils
from werkzeug.utils
from werkzeug.utils
from werkzeug.utils
from werkzeug.utils
from werkzeug.utils
from werkzeug.utils
from werkzeug.utils
from werkzeug.utils
from werkzeug.utils
from werkzeug.utils
from werkzeug.utils
from werkzeug.utils
from werkzeug.utils
from werkzeug.utils
from werkzeug.utils
from werkzeug.utils
from werkzeug.utils
from werkzeug.utils
from werkzeug.utils
from werkzeug.utils
from werkzeug.utils
from werkzeug.utils
from werkzeug.utils
from werkzeug.utils
from werkzeug.utils
from werkzeug.utils
from werkzeug.utils
from werkzeug.utils
from werkzeug.utils
from werkzeug.utils
from werkzeug.utils
from werkzeug.utils
from werkzeug.utils
from werkzeug.utils
from werkzeug.utils
from werkzeug.utils
from werkzeug.utils
from werkzeug.utils
from werkzeug.utils
from werkzeug.utils
from werkzeug.utils
from werkzeug.utils
from werkzeug.utils
from werkzeug.utils
from werkzeug.utils
from werkzeug.utils
from werkzeug.utils
from werkzeug.utils
from werkzeug.utils
from werkzeug.utils
from werkzeug.utils
from werkzeug.utils
from werkzeug.utils
from werkzeug.utils
from werkzeug.utils
from werkzeug.utils
from werkzeug.utils
from werkzeug.utils
from werkzeug.utils
from werkzeug.utils
from werkzeug.utils
from werkzeug.utils
from werkzeug.utils
from werkzeug.utils
from werkzeug.utils
from werkzeug.utils
from werkzeug.utils
from werkzeug.utils
from werkzeug.utils
from werkzeug.utils
from werkzeug.utils
from werkzeug.utils
from werkzeug.utils
from werkzeug.utils
from werkzeug.utils
from werkzeug.utils
from werkzeug.utils
from werkzeug.utils
from werkzeug.utils
from werkzeug.utils
from werkzeug.utils
from werkzeug.utils
from werkzeug.utils
from werkzeug.utils
from werkzeug.utils
from werkzeug.utils
from werkzeug.utils
from werkzeug.utils
from werkzeug.utils
from werkzeug.utils
from werkzeug.utils
from werkzeug.utils
from werkzeug.utils
from werkzeug.utils
from werkzeug.utils
from werkzeug.utils
from werkzeug.utils
from werkzeug.utils
from werkzeug.utils
from werkzeug.utils
from werkzeug.utils
from werkzeug.utils
from werkzeug.utils
from werkzeug.utils
from werkzeug.utils
from werkzeug.utils
from werkzeug.utils
from werkzeug.utils
from werkzeug.utils
from werkzeug.utils
from werkzeug.utils
from werkzeug.utils
from werkzeug.utils
from werkzeug.utils
from werkzeug.utils
from werkzeug.utils
from werkzeug.utils
from werkzeug.utils
from werkzeug.utils
from werkzeug.utils
from werkzeug.utils
from werkzeug.utils
from werkzeug.utils
from werkzeug.utils
from werkzeug.utils
from werkzeug.utils
from werkzeug.utils
from werkzeug.utils
from werkzeug.utils
from werkzeug.utils
from werkzeug.utils
from werkzeug.utils
from werkzeug.utils
from werkzeug.utils
from werkzeug.utils
from werkzeug.utils
from werkzeug.utils
from werkzeug.utils
from werkzeug.utils
from werkzeug.utils
from werkzeug.utils
from werkzeug.utils
from werkzeug.utils
from werkzeug.utils
from werkzeug.utils
from werkzeug.utils
from werkzeug.utils
from werkzeug.utils
from werkzeug.utils
from werkzeug.utils
from werkzeug.utils
from werkzeug.utils
from werkzeug.utils
from werkzeug.utils
from werkzeug.utils
from werkzeug.utils
from werkzeug.utils
from werkzeug.utils
from werkzeug.utils
from werkzeug.utils
from werkzeug.utils
from werkzeug.utils
from werkzeug.utils
from werkzeug.utils
from werkzeug.utils
from werkzeug.utils
from werkzeug.utils
from werkzeug.utils
from werkzeug.utils
from werkzeug.utils
from werkzeug.utils
from werkzeug.utils
from werkzeug.utils
from werkzeug.utils
from werkzeug.utils
from werkzeug.utils
from werkzeug.utils
from werkzeug.utils
from werkzeug.utils
from werkzeug.utils
from werkzeug.utils
from werkzeug.utils
from werkzeug.utils
from werkzeug.utils
from werkzeug.utils
from werkzeug.utils
from werkzeug.utils
from werkzeug.utils
from werkzeug.utils
from werkzeug.utils
from werkzeug.utils
from werkzeug.utils
from werkzeug.utils
from werkzeug.utils
from werkzeug.utils
from werkzeug.utils
from werkzeug.utils
from werkzeug.utils
from werkzeug.utils
from werkzeug.utils
from werkzeug.utils
from werkzeug.utils
from werkzeug.utils
from werkzeug.utils
from werkzeug.utils
from werkzeug.utils
from werkzeug.utils
from werkzeug.utils
from werkzeug.utils
from werkzeug.utils
from werkzeug.utils
from werkzeug.utils
from werkzeug.utils
from werkzeug.utils
from werkzeug.utils
from werkzeug.utils
from werkzeug.utils
from werkzeug.utils
from werkzeug.utils
from werkzeug.utils
from werkzeug.utils
from werkzeug.utils
from werkzeug.utils
from werkzeug.utils
from werkzeug.utils
from werkzeug.utils
from werkzeug.utils
from werkzeug.utils
from werkzeug.utils
from werkzeug.utils
from werkzeug.utils
from werkzeug.utils
from werkzeug.utils
from werkzeug.utils
from werkzeug.utils
from werkzeug.utils
from werkzeug.utils
from werkzeug.utils
from werkzeug.utils
from werkzeug.utils
from werkzeug.utils
from werkzeug.utils
from werkzeug.utils
from werkzeug.utils
from werkzeug.utils
from werkzeug.utils
from werkzeug.utils
from werkzeug.utils
from werkzeug.utils
from werkzeug.utils
from werkzeug.utils
from werkzeug.utils
from werkzeug.utils
from werkzeug.utils
from werkzeug.utils
from werkzeug.utils
from werkzeug.utils
from werkzeug.utils
from werkzeug.utils
from werkzeug.utils
from werkzeug.utils
from werkzeug.utils
from werkzeug.utils
from werkzeug.utils
from werkzeug.utils
from werkzeug.utils
from werkzeug.utils
from werkzeug.utils
from werkzeug.utils
from werkzeug.utils
from werkzeug.utils
from werkzeug.utils
from werkzeug.utils
from werkzeug.utils
from werkzeug.utils
from werkzeug.utils
from werkzeug.utils
from werkzeug.utils
from werkzeug.utils
from werkzeug.utils
from werkzeug.utils
from werkzeug.utils
from werkzeug.utils
from werkzeug.utils
from werkzeug.utils
from werkzeug.utils
from werkzeug.utils
from werkzeug.utils
from werkzeug.utils
from werkzeug.utils
from werkzeug.utils
from werkzeug.utils
from werkzeug.utils
from werkzeug.utils
from werkzeug.utils
from werkzeug.utils
from werkzeug.utils
from werkzeug.utils
from werkzeug.utils
from werkzeug.utils
from werkzeug.utils
from werkzeug.utils
from werkzeug.utils
from werkzeug.utils
from werkzeug.utils
from werkzeug.utils
from werkzeug.utils
from werkzeug.utils
from werkzeug.utils
from werkzeug.utils
from werkzeug.utils
from werkzeug.utils
from werkzeug.utils
from werkzeug.utils
from werkzeug.utils
from werkzeug.utils
from werkzeug.utils
from werkzeug.utils
from werkzeug.utils
from werkzeug.utils
from werkzeug.utils
from werkzeug.utils
from werkzeug.utils
from werkzeug.utils
from werkzeug.utils
from werkzeug.utils
from werkzeug.utils
from werkzeug.utils
from werkzeug.utils
from werkzeug.utils
from werkzeug.utils
from werkzeug.utils
from werkzeug.utils
from werkzeug.utils
from werkzeug.utils
from werkzeug.utils
from werkzeug.utils
from werkzeug.utils
from werkzeug.utils
from werkzeug.utils
from werkzeug.utils
from werkzeug.utils
from werkzeug.utils
from werkzeug.utils
from werkzeug.utils
from werkzeug.utils
from werkzeug.utils
from werkzeug.utils
from werkzeug.utils
from werkzeug.utils
from werkzeug.utils
from werkzeug.utils
from werkzeug.utils
from werkzeug.utils
from werkzeug.utils
from werkzeug.utils
from werkzeug.utils
from werkzeug.utils
from werkzeug.utils
from werkzeug.utils
from werkzeug.utils
from werkzeug.utils
from werkzeug.utils
from werkzeug.utils
from werkzeug.utils
from werkzeug.utils
from werkzeug.utils
from werkzeug.utils
from werkzeug.utils
from werkzeug.utils
from werkzeug.utils
from werkzeug.utils
from werkzeug.utils
from werkzeug.utils
from werkzeug.utils
from werkzeug.utils
from werkzeug.utils
from werkzeug.utils
from werkzeug.utils
from werkzeug.utils
from werkzeug.utils
from werkzeug.utils
from werkzeug.utils
from werkzeug.utils
from werkzeug.utils
from werkzeug.utils
from werkzeug.utils
from werkzeug.utils
from werkzeug.utils
from werkzeug.utils
from werkzeug.utils
from werkzeug.utils
from werkzeug.utils
from werkzeug.utils
from werkzeug.utils
from werkzeug.utils
from werkzeug.utils
from werkzeug.utils
from werkzeug.utils
from werkzeug.utils
from werkzeug.utils
from werkzeug.utils
from werkzeug.utils
from werkzeug.utils
from werkzeug.utils
from werkzeug.utils
from werkzeug.utils
from werkzeug.utils
from werkzeug.utils
from werkzeug.utils
from werkzeug.utils
from werkzeug.utils
from werkzeug.utils
from werkzeug.utils
from werkzeug.utils
from werkzeug.utils
from werkzeug.utils
from werkzeug.utils
from werkzeug.utils
from werkzeug.utils
from werkzeug.utils
from werkzeug.utils
from werkzeug.utils
from werkzeug.utils
from werkzeug.utils
from werkzeug.utils
from werkzeug.utils
from werkzeug.utils
from werkzeug.utils
from werkzeug.utils
from werkzeug.utils
from werkzeug.utils
from werkzeug.utils
from werkzeug.utils
from werkzeug.utils
from werkzeug.utils
from werkzeug.utils
from werkzeug.utils
from werkzeug.utils
from werkzeug.utils
from werkzeug.utils
from werkzeug.utils
from werkzeug.utils
from werkzeug.utils
from werkzeug.utils
from werkzeug.utils
from werkzeug.utils
from werkzeug.utils
from werkzeug.utils
from werkzeug.utils
from werkzeug.utils
from werkzeug.utils
from werkzeug.utils
from werkzeug.utils
from werkzeug.utils
from werkzeug.utils
from werkzeug.utils
from werkzeug.utils
from werkzeug.utils
from werkzeug.utils
from werkzeug.utils
from werkzeug.utils
from werkzeug.utils
from werkzeug.utils
from werkzeug.utils
from werkzeug.utils
from werkzeug.utils
from werkzeug.utils
from werkzeug.utils
from werkzeug.utils
from werkzeug.utils
from werkzeug.utils
from werkzeug.utils
from werkzeug.utils
from werkzeug.utils
from werkzeug.utils
from werkzeug.utils
from werkzeug.utils
from werkzeug.utils
from werkzeug.utils
from werkzeug.utils
from werkzeug.utils
from werkzeug.utils
from werkzeug.utils
from werkzeug.utils
from werkzeug.utils
from werkzeug.utils
from werkzeug.utils
from werkzeug.utils
from werkzeug.utils
from werkzeug.utils
from werkzeug.utils
from werkzeug.utils
from werkzeug.utils
from werkzeug.utils
from werkzeug.utils
from werkzeug.utils
from werkzeug.utils
from werkzeug.utils
from werkzeug.utils
from werkzeug.utils
from werkzeug.utils
from werkzeug.utils
from werkzeug.utils
from werkzeug.utils
from werkzeug.utils
from werkzeug.utils
from werkzeug.utils
from werkzeug.utils
from werkzeug.utils
from werkzeug.utils
from werkzeug.utils
from werkzeug.utils
from werkzeug.utils
from werkzeug.utils
from werkzeug.utils
from werkzeug.utils
from werkzeug.utils
from werkzeug.utils
from werkzeug.utils
from werkzeug.utils
from werkzeug.utils
from werkzeug.utils
from werkzeug.utils
from werkzeug.utils
from werkzeug.utils
from werkzeug.utils
from werkzeug.utils
from werkzeug.utils
from werkzeug.utils
from werkzeug.utils
from werkzeug.utils
from werkzeug.utils
from werkzeug.utils
from werkzeug.utils
from werkzeug.utils
from werkzeug.utils
from werkzeug.utils
from werkzeug.utils
from werkzeug.utils
from werkzeug.utils
from werkzeug.utils
from werkzeug.utils
from werkzeug.utils
from werkzeug.utils
from werkzeug.utils
from werkzeug.utils
from werkzeug.utils
from werkzeug.utils
from werkzeug.utils
from werkzeug.utils
from werkzeug.utils
from werkzeug.utils
from werkzeug.utils
from werkzeug.utils
from werkzeug.utils
from werkzeug.utils
from werkzeug.utils
from werkzeug.utils
from werkzeug.utils
from werkzeug.utils
from werkzeug.utils
from werkzeug.utils
from werkzeug.utils
from werkzeug.utils
from werkzeug.utils
from werkzeug.utils
from werkzeug.utils
from werkzeug.utils
from werkzeug.utils
from werkzeug.utils
from werkzeug.utils
from werkzeug.utils
from werkzeug.utils
from werkzeug.utils
from werkzeug.utils
from werkzeug.utils
from werkzeug.utils
from werkzeug.utils
from werkzeug.utils
from werkzeug.utils
from werkzeug.utils
from werkzeug.utils
from werkzeug.utils
from werkzeug.utils
from werkzeug.utils
from werkzeug.utils
from werkzeug.utils
from werkzeug.utils
from werkzeug.utils
from werkzeug.utils
from werkzeug.utils
from werkzeug.utils
from werkzeug.utils
from werkzeug.utils
from werkzeug.utils
from werkzeug.utils
from werkzeug.utils
from werkzeug.utils
from werkzeug.utils
from werkzeug.utils
from werkzeug.utils
from werkzeug.utils
from werkzeug.utils
from werkzeug.utils
from werkzeug.utils
from werkzeug.utils
from werkzeug.utils
from werkzeug.utils
from werkzeug.utils
from werkzeug.utils
from werkzeug.utils
from werkzeug.utils
from werkzeug.utils
from werkzeug.utils
from werkzeug.utils
from werkzeug.utils
from werkzeug.utils
from werkzeug.utils
from werkzeug.utils
from werkzeug.utils
from werkzeug.utils
from werkzeug.utils
from werkzeug.utils
from werkzeug.utils
from werkzeug.utils
from werkzeug.utils
from werkzeug.utils
from werkzeug.utils
from werkzeug.utils
from werkzeug.utils
from werkzeug.utils
from werkzeug.utils
from werkzeug.utils
from werkzeug.utils
from werkzeug.utils
from werkzeug.utils
from werkzeug.utils
from werkzeug.utils
from werkzeug.utils
from werkzeug.utils
from werkzeug.utils
from werkzeug.utils
from werkzeug.utils
from werkzeug.utils
from werkzeug.utils
from werkzeug.utils
from werkzeug.utils
from werkzeug.utils
from werkzeug.utils
from werkzeug.utils
from werkzeug.utils
from werkzeug.utils
from werkzeug.utils
from werkzeug.utils
from werkzeug.utils
from werkzeug.utils
from werkzeug.utils
from werkzeug.utils
from werkzeug.utils
from werkzeug.utils
from werkzeug.utils
from werkzeug.utils
from werkzeug.utils
from werkzeug.utils
from werkzeug.utils
from werkzeug.utils
from werkzeug.utils
from werkzeug.utils
from werkzeug.utils
from werkzeug.utils
from werkzeug.utils
from werkzeug.utils
from werkzeug.utils
from werkzeug.utils
from werkzeug.utils
from werkzeug.utils
from werkzeug.utils
from werkzeug.utils
from werkzeug.utils
from werkzeug.utils
from werkzeug.utils
from werkzeug.utils
from werkzeug.utils
from werkzeug.utils
from werkzeug.utils
from werkzeug.utils
from werkzeug.utils
from werkzeug.utils
from werkzeug.utils
from werkzeug.utils
from werkzeug.utils
from werkzeug.utils
from werkzeug.utils
from werkzeug.utils
from werkzeug.utils
from werkzeug.utils
from werkzeug.utils
from werkzeug.utils
from werkzeug.utils
from werkzeug.utils
from werkzeug.utils
from werkzeug.utils
from werkzeug.utils
from werkzeug.utils
from werkzeug.utils
from werkzeug.utils
from werkzeug.utils
from werkzeug.utils
from werkzeug.utils
from werkzeug.utils
from werkzeug.utils
from werkzeug.utils
from werkzeug.utils
from werkzeug.utils
from werkzeug.utils
from werkzeug.utils
from werkzeug.utils
from werkzeug.utils
from werkzeug.utils
from werkzeug.utils
from werkzeug.utils
from werkzeug.utils
from werkzeug.utils
from werkzeug.utils
from werkzeug.utils
from werkzeug.utils
from werkzeug.utils
from werkzeug.utils
from werkzeug.utils
from werkzeug.utils
from werkzeug.utils
from werkzeug.utils
from werkzeug.utils
from werkzeug.utils
from werkzeug.utils
from werkzeug.utils
from werkzeug.utils
from werkzeug.utils
from werkzeug.utils
from werkzeug.utils
from werkzeug.utils
from werkzeug.utils
from werkzeug.utils
from werkzeug.utils
from werkzeug.utils
from werkzeug.utils
from werkzeug.utils
from werkzeug.utils
from werkzeug.utils
from werkzeug.utils
from werkzeug.utils
from werkzeug.utils
from werkzeug.utils
from werkzeug.utils
from werkzeug.utils
from werkzeug.utils
from werkzeug.utils
from werkzeug.utils
from werkzeug.utils
from werkzeug.utils
from werkzeug.utils
from werkzeug.utils
from werkzeug.utils
from werkzeug.utils
from werkzeug.utils
from werkzeug.utils
from werkzeug.utils
from werkzeug.utils
from werkzeug.utils
from werkzeug.utils
from werkzeug.utils
from werkzeug.utils
from werkzeug.utils
from werkzeug.utils
from werkzeug.utils
from werkzeug.utils
from werkzeug.utils
from werkzeug.utils
from werkzeug.utils
from werkzeug.utils
from werkzeug.utils
from werkzeug.utils
from werkzeug.utils
from werkzeug.utils
from werkzeug.utils
from werkzeug.utils
from werkzeug.utils
from werkzeug.utils
from werkzeug.utils
from werkzeug.utils
from werkzeug.utils
from werkzeug.utils
from werkzeug.utils
from werkzeug.utils
from werkzeug.utils
from werkzeug.utils
from werkzeug.utils
from werkzeug.utils
from werkzeug.utils
from werkzeug.utils
from werkzeug.utils
from werkzeug.utils
from werkzeug.utils
from werkzeug.utils
from werkzeug.utils
from werkzeug.utils
from werkzeug.utils
from werkzeug.utils
from werkzeug.utils
from werkzeug.utils
from werkzeug.utils
from werkzeug.utils
from werkzeug.utils
from werkzeug.utils
from werkzeug.utils
from werkzeug.utils
from werkzeug.utils
from werkzeug.utils
from werkzeug.utils
from werkzeug.utils
from werkzeug.utils
from werkzeug.utils
from werkzeug.utils
from werkzeug.utils
from werkzeug.utils
from werkzeug.utils
from werkzeug.utils
from werkzeug.utils
from werkzeug.utils
from werkzeug.utils
from werkzeug.utils
from werkzeug.utils
from werkzeug.utils
from werkzeug.utils
from werkzeug.utils
from werkzeug.utils
from werkzeug.utils
from werkzeug.utils
from werkzeug.utils
from werkzeug.utils
from werkzeug.utils
from werkzeug.utils
from werkzeug.utils
from werkzeug.utils
from werkzeug.utils
from werkzeug.utils
from werkzeug.utils
from werkzeug.utils
from werkzeug.utils
from werkzeug.utils
from werkzeug.utils
from werkzeug.utils
from werkzeug.utils
from werkzeug.utils
from werkzeug.utils
from werkzeug.utils
from werkzeug.utils
from werkzeug.utils
from werkzeug.utils
from werkzeug.utils
from werkzeug.utils
from werkzeug.utils
from werkzeug.utils
from werkzeug.utils
from werkzeug.utils
from werkzeug.utils
from werkzeug.utils
from werkzeug.utils
from werkzeug.utils
from werkzeug.utils
from werkzeug.utils
from werkzeug.utils
from werkzeug.utils
from werkzeug.utils
from werkzeug.utils
from werkzeug.utils
from werkzeug.utils
from werkzeug.utils
from werkzeug.utils
from werkzeug.utils
from werkzeug.utils
import json
import logging
import functools
import secrets
import time
import threading
from datetime import datetime, timedelta, timezone
import hashlib
import math
import re
import random
import string
from werkzeug.exceptions import NotFound

# 
import pyotp
from flask import Blueprint, request, jsonify, g, current_app as app, render_template, redirect, url_for, flash, send_from_directory, abort, make_response, session
from flask_jwt_extended import create_access_token, jwt_required, get_jwt_identity
from werkzeug.security import generate_password_hash, check_password_hash
from sqlalchemy import func, and_, or_, not_
from sqlalchemy.exc import IntegrityError

# 
from .models import (
    db, User, Subscription, ChatGPTAccount, AdspowerAccount, 
    Device, PaymentRecord, Payment, LoginSession, UserAdspowerAccount,
    SubscriptionType, EmailVerification
)
from .services.auth_service import AuthService, DeviceAuthService, TwoFactorAuthService
from .services.payment_service import AlipayService, PaymentService # Import PaymentService
from .services.device_service import DeviceService
from .services.subscription_service import SubscriptionService
from .services.email_service import EmailService
from .adspower_api import get_adspower_api
from config import MAX_DEVICES_PER_USER # 
from .webdriver_pool import get_account_driver_manager
from .services.epay_service import EpayService #  EpayService

# 
logger = logging.getLogger(__name__)

# 
api = Blueprint('api', __name__, url_prefix='/api')

# 
auth_service = AuthService()
device_auth_service = DeviceAuthService()
two_factor_auth_service = TwoFactorAuthService()
device_service = DeviceService()
email_service = EmailService()
alipay_service = AlipayService()  # 
subscription_service = SubscriptionService()  # Add this import
epay_service = EpayService() #  EpayService
payment_service = PaymentService() # Instantiate PaymentService globally or within the route

# 
def login_required(f):
    """
    
    JWTg
    """
    @functools.wraps(f)
    def decorated_function(*args, **kwargs):
        # 
        auth_header = request.headers.get('Authorization')
        token = None
        logger.debug(f"[] Authorization: {auth_header}")
        if auth_header and auth_header.startswith('Bearer '):
            token = auth_header.split(" ")[1]
            logger.debug(f"[] : {token[:10]}...{token[-10:] if len(token) > 20 else ''}")
        else:
            logger.warning(f"[] Bearer: {auth_header}")

        if not token:
            logger.warning("[] Bearer")
            return jsonify({'success': False, 'message': ''}), 401

        # 
        auth_service = AuthService() #  app context 
        user, message = auth_service.verify_token(token)

        if not user:
            # verify_token 
            return jsonify({'success': False, 'message': message}), 401

        #  g
        g.user = user
        logger.info(f"[]  {user.id} ({user.email}) ")
        return f(*args, **kwargs)
    return decorated_function

# 
def admin_required(f):
    """
    
    login_required
    """
    @functools.wraps(f)
    @login_required
    def decorated_function(*args, **kwargs):
        if not g.user.is_admin:
            logger.warning(f"[]  {g.user.id} ({g.user.email}) ")
            return jsonify({"success": False, "message": ""}), 403
        
        logger.info(f"[]  {g.user.id} ({g.user.email}) ")
        return f(*args, **kwargs)
    return decorated_function

# 
def device_required(f):
    """
    
    IDg
    """
    @functools.wraps(f)
    @login_required
    def decorated_function(*args, **kwargs):
        # ID
        device_id = request.headers.get('X-Device-ID') or request.args.get('device_id')
        if not device_id:
            logger.warning(f"[]  {g.user.id} ID")
            return jsonify({"success": False, "message": "ID"}), 400
        
        # 
        success, device, error_msg = device_auth_service.verify_device(g.user.id, device_id)
        if not success:
            logger.warning(f"[]  {g.user.id} ID {device_id}: {error_msg}")
            return jsonify({"success": False, "message": error_msg}), 403
        
        # g
        g.device = device
        logger.info(f"[]  {g.user.id}  {device.id} ")
        
        return f(*args, **kwargs)
    return decorated_function

# 
@api.route('/auth/register', methods=['POST'])
def register():
    """"""
    data = request.json
    email = data.get('email')
    password = data.get('password')
    verification_code = data.get('verification_code') # 

    # 
    if not all([email, password, verification_code]): # 
        logger.warning(f"[] : email={bool(email)}, password={bool(password)}, code={bool(verification_code)}")
        return jsonify({'success': False, 'message': ' (, , )'}), 400

    #  ()
    if '@' not in email or '.' not in email.split('@')[-1]:
        logger.warning(f"[] : {email}")
        return jsonify({'success': False, 'message': ''}), 400
        
    #  ( AuthService )

    # AuthService
    auth_service = AuthService()

    # 
    user, message = auth_service.register_user(email, password, verification_code) # 
    
    if user:
        # 
        logger.info(f"[]  {email} ID: {user.id}")
        # 
        # token = auth_service.generate_token(user)
        return jsonify({'success': True, 'message': message, 'user_id': user.id}), 201
    else:
        # 
        logger.warning(f"[]  {email} : {message}")
        return jsonify({'success': False, 'message': message}), 400

@api.route('/auth/verify-email', methods=['POST'])
def verify_email():
    """API
    
    :
    {
        "email": "",
        "code": ""
    }
    
    :
    {
        "success": true/false,
        "message": ""
    }
    """
    data = request.json
    
    # 
    if not all(k in data for k in ['email', 'code']):
        logger.warning(f"[] : {data.keys()}")
        return jsonify({'success': False, 'message': ''}), 400
    
    logger.info(f"[] : {data['email']}")
    
    # 
    success, message = auth_service.verify_email(
        email=data['email'],
        code=data['code']
    )
    
    if success:
        logger.info(f"[] {data['email']} ")
        return jsonify({'success': True, 'message': message}), 200
    else:
        logger.warning(f"[] {data['email']} : {message}")
        return jsonify({'success': False, 'message': message}), 400

@api.route('/auth/send-verification', methods=['POST'])
def send_verification():
    """API
    
    :
    {
        "email": "",
        "type": "register/login/reset"
    }
    
    :
    {
        "success": true/false,
        "message": ""
    }
    """
    data = request.json
    
    # 
    if 'email' not in data:
        logger.warning("[] ")
        return jsonify({'success': False, 'message': ''}), 400
    
    # 
    code_type = data.get('type', 'register')
    if code_type not in ['register', 'login', 'reset']:
        logger.warning(f"[] : {code_type}")
        return jsonify({'success': False, 'message': ''}), 400
    
    logger.info(f"[] {code_type}: {data['email']}")
    
    # 
    success, message, _ = email_service.send_verification_email(
        email=data['email'],
        code_type=code_type
    )
    
    if success:
        logger.info(f"[] : {data['email']} (: {code_type})")
        return jsonify({'success': True, 'message': message}), 200
    else:
        logger.warning(f"[] : {data['email']} (: {code_type}) - {message}")
        return jsonify({'success': False, 'message': message}), 400

@api.route('/auth/login', methods=['POST'])
def login():
    """API
    
    :
    {
        "email": "",
        "password": "",
        "verification_code": ""
    }
    
    :
    {
        "success": true/false,
        "message": "",
        "token": "JWT",
        "user": {}
    }
    """
    data = request.json
    
    # 
    if not all(k in data for k in ['email', 'password']):
        logger.warning(f"[] : {data.keys()}")
        return jsonify({'success': False, 'message': ''}), 400
    
    logger.info(f"[] : {data['email']}")
    
    # 
    user, token, message = auth_service.login_user(
        email=data['email'],
        password=data['password'],
        verification_code=data.get('verification_code')
    )
    
    if user and token:
        logger.info(f"[]  {user.id} ({user.email}) ")
        return jsonify({
            'success': True,
            'message': message,
            'token': token,
            'user': {
                'id': user.id,
                'email': user.email,
                'username': user.email, # <--  username 
                'is_admin': user.is_admin,
                'is_email_verified': user.is_email_verified
            }
        }), 200
    else:
        logger.warning(f"[]  {data['email']} : {message}")
        return jsonify({'success': False, 'message': message}), 401

@api.route('/auth/reset-password-request', methods=['POST'])
def reset_password_request():
    """API
    
    :
    {
        "email": ""
    }
    
    :
    {
        "success": true/false,
        "message": ""
    }
    """
    data = request.json
    
    # 
    if 'email' not in data:
        logger.warning("[] ")
        return jsonify({'success': False, 'message': ''}), 400
    
    logger.info(f"[] : {data['email']}")
    
    # 
    success, message = auth_service.reset_password_request(
        email=data['email']
    )
    
    if success:
        logger.info(f"[] : {data['email']}")
        return jsonify({'success': True, 'message': message}), 200
    else:
        logger.warning(f"[] : {data['email']} - {message}")
        return jsonify({'success': False, 'message': message}), 400

@api.route('/auth/reset-password', methods=['POST'])
def reset_password():
    """API
    
    :
    {
        "email": "",
        "code": "",
        "new_password": ""
    }
    
    :
    {
        "success": true/false,
        "message": ""
    }
    """
    data = request.json
    
    # 
    if not all(k in data for k in ['email', 'code', 'new_password']):
        logger.warning(f"[] : {data.keys()}")
        return jsonify({'success': False, 'message': ''}), 400
    
    logger.info(f"[] : {data['email']}")
    
    # 
    success, message = auth_service.reset_password(
        email=data['email'],
        code=data['code'],
        new_password=data['new_password']
    )
    
    if success:
        logger.info(f"[] : {data['email']}")
        return jsonify({'success': True, 'message': message}), 200
    else:
        logger.warning(f"[] : {data['email']} - {message}")
        return jsonify({'success': False, 'message': message}), 400

# 
@api.route('/users/me', methods=['GET'])
@login_required
def get_user_info():
    """"""
    try:
        user = g.user
        logger.info(f"[]  {user.id} ")
        
        # 
        subscription = auth_service.get_user_subscription(user.id)
        
        # 
        devices = Device.query.filter_by(user_id=user.id).all()
        
        # 
        payments = PaymentRecord.query.filter_by(
            user_id=user.id
        ).order_by(
            PaymentRecord.created_at.desc()
        ).limit(10).all()
        
        logger.debug(f"[]  {user.id}  {len(devices)}  {len(payments)} ")
        
        return jsonify({
            "success": True,
            "data": {
                "user": user.to_dict(),
                "subscription": subscription.to_dict() if subscription else None,
                "devices": [device.to_dict() for device in devices],
                "payments": [payment.to_dict() for payment in payments]
            }
        })
        
    except Exception as e:
        logger.exception(f"[]  {g.user.id} : {str(e)}")
        return jsonify({"success": False, "message": ""}), 500

@api.route('/users/me', methods=['PUT'])
@login_required
def update_user_info():
    """"""
    try:
        data = request.json
        if not data:
            logger.warning(f"[]  {g.user.id} ")
            return jsonify({"success": False, "message": ""}), 400
        
        user = g.user
        logger.info(f"[]  {user.id} : {list(data.keys())}")
        
        # 
        if 'email' in data:
            # 
            existing = User.query.filter(
                User.email == data['email'],
                User.id != user.id
            ).first()
            if existing:
                logger.warning(f"[]  {user.id}  {data['email']}")
                return jsonify({"success": False, "message": ""}), 400
            
            old_email = user.email
            user.email = data['email']
            logger.info(f"[]  {user.id}  {old_email}  {data['email']}")
        
        # 
        if 'password' in data:
            # 
            old_password = data.get('old_password')
            if not old_password or not user.check_password(old_password):
                logger.warning(f"[]  {user.id} ")
                return jsonify({"success": False, "message": ""}), 400
            
            # 
            is_valid, msg = auth_service.validate_password(data['password'])
            if not is_valid:
                logger.warning(f"[]  {user.id} : {msg}")
                return jsonify({"success": False, "message": msg}), 400
            
            user.set_password(data['password'])
            logger.info(f"[]  {user.id} ")
        
        db.session.commit()
        logger.info(f"[]  {user.id} ")
        
        return jsonify({
            "success": True,
            "message": "",
            "data": {
                "user": user.to_dict()
            }
        })
        
    except Exception as e:
        logger.exception(f"[]  {g.user.id} : {str(e)}")
        return jsonify({"success": False, "message": ""}), 500

#  - 
@api.route('/admin/devices', methods=['GET'])
@admin_required
def get_all_devices():
    """(Admin)  () """
    page = request.args.get('page', 1, type=int)
    per_page = request.args.get('per_page', 10, type=int)
    
    try:
        logger.info(f"[]  (: {page}, : {per_page})")
        
        # 
        devices = Device.query.paginate(page=page, per_page=per_page, error_out=False)
        
        # 
        result = []
        for device in devices.items:
            user = User.query.get(device.user_id) if device.user_id else None
            
            # ADSpower
            adspower_account = None
            if device.adspower_account_id:
                account = AdspowerAccount.query.get(device.adspower_account_id)
                if account:
                    adspower_account = {
                        'id': account.id,
                        'username': account.username,
                        'is_active': account.is_active,
                        'current_devices': account.current_devices,
                        'max_devices': account.max_devices
                    }
            
            # IP - 
            ip_address = device.device_ip
            if ip_address:
                # IP - HTML
                import re
                # IP
                ip_match = re.search(r'(\d{1,3}\.\d{1,3}\.\d{1,3}\.\d{1,3}|[0-9a-f:]+)', ip_address)
                if ip_match:
                    ip_address = ip_match.group(1)
                else:
                    # HTML
                    ip_address = re.sub(r'<[^>]*>?', '', ip_address).strip()
            
            device_info = {
                'id': device.id,
                'user_id': device.user_id,
                'user_email': user.email if user else '',
                'adspower_account_id': device.adspower_account_id,
                'adspower_username': adspower_account['username'] if adspower_account else '', # 
                'device_name': device.device_name,
                'device_ip': ip_address,  # IP
                'device_type': device.device_type, # 
                'last_login': device.last_login.isoformat() if device.last_login else None,
                'last_active': device.last_active.isoformat() if device.last_active else None,
                'created_at': device.created_at.isoformat(),
                'user': {
                    'id': user.id if user else None,
                    'username': user.email if user else '', # Use email instead of username
                    'email': user.email if user else None
                },
                'adspower_account': adspower_account or {
                    'id': None,
                    'username': '',
                    'is_active': False,
                    'current_devices': 0,
                    'max_devices': 0
                }
            }
            result.append(device_info)
        
        logger.info(f"[]  {len(result)}  {devices.total} ")
        
        return jsonify({
            "success": True,
            "data": {
                "devices": result,
                "total": devices.total,
                "pages": devices.pages,
                "page": devices.page,
                "per_page": devices.per_page
            }
        })
        
    except Exception as e:
        logger.exception(f"[] : {str(e)}")
        return jsonify({"success": False, "message": ""}), 500

@api.route('/devices', methods=['GET'])
@login_required
def get_devices():
    """"""
    try:
        user = g.user
        logger.info(f"[]  {user.id} ")
        
        devices = Device.query.filter_by(user_id=user.id).order_by(Device.last_login.desc()).all()
        
        devices_data = []
        for device in devices:
            devices_data.append({
                'id': device.id, # Use DB primary key for delete operations
                'name': device.device_name,
                'ip_address': device.device_ip,
                'device_type': device.device_type, # Changed key from 'type' to 'device_type'
                'last_login': device.last_login.isoformat() if device.last_login else None,
                'created_at': device.created_at.isoformat() if device.created_at else None
            })
        
        logger.info(f"[]  {user.id}  {len(devices_data)} ")
            
        return jsonify({'success': True, 'devices': devices_data})
    except Exception as e:
        logger.exception(f"[]  {g.user.id} : {str(e)}")
        return jsonify({"success": False, "message": ""}), 500

@api.route('/devices', methods=['POST'])
@login_required
def register_device():
    """"""
    try:
        data = request.json
        if not data:
            logger.warning(f"[]  {g.user.id} ")
            return jsonify({"success": False, "message": ""}), 400
        
        user = g.user
        
        # 
        device_id = data.get('device_id')
        device_info = {
            'name': data.get('name'),
            'type': data.get('type'),
            'platform': data.get('platform'),
            'ip_address': request.remote_addr
        }
        
        logger.info(f"[]  {user.id} : ID={device_id}, ={data.get('type')}, IP={request.remote_addr}")
        
        if not device_id:
            logger.warning(f"[]  {user.id} ID")
            return jsonify({"success": False, "message": "ID"}), 400
        
        # 
        device_count = Device.query.filter_by(user_id=user.id).count()
        
        # 
        subscription = auth_service.get_user_subscription(user.id)
        max_devices = subscription.max_devices if subscription else 2
        
        logger.info(f"[]  {user.id} : {device_count}: {max_devices}")
        
        # 
        if device_count >= max_devices:
            logger.warning(f"[]  {user.id}  ({max_devices})")
            return jsonify({"success": False, "message": f"({max_devices})"}), 400
        
        # 
        success, device, message = device_auth_service.register_device(
            user.id, device_id, device_info
        )
        
        if not success:
            logger.warning(f"[]  {user.id} : {message}")
            return jsonify({"success": False, "message": message}), 400
        
        # 
        success, device_info, _ = device_auth_service.get_device_info(device_id)
        
        logger.info(f"[]  {user.id} : ID={device_id}, DB_ID={device.id}")
        
        return jsonify({
            "success": True,
            "message": message,
            "data": device_info if success else device.to_dict()
        })
        
    except Exception as e:
        logger.exception(f"[]  {g.user.id} : {str(e)}")
        return jsonify({"success": False, "message": ""}), 500

@api.route('/devices/<device_id>', methods=['GET'])
@login_required
def get_device_info(device_id):
    """"""
    try:
        user = g.user
        logger.info(f"[]  {user.id} : {device_id}")
        
        # 
        device = Device.query.filter_by(user_id=user.id, device_id=device_id).first()
        if not device:
            return jsonify({"success": False, "message": ""}), 404
        
        # 
        success, device_info, message = device_auth_service.get_device_info(device_id)
        if not success:
            return jsonify({"success": False, "message": message}), 400
        
        return jsonify({
            "success": True,
            "data": device_info
        })
        
    except Exception as e:
        logger.exception(f": {str(e)}")
        return jsonify({"success": False, "message": ""}), 500

@api.route('/admin/devices/<int:device_id>', methods=['DELETE'])
@admin_required
def admin_delete_device(device_id):
    """ - """
    admin_user = g.user
    logger.info(f" {admin_user.id}  DB ID: {device_id}")
    
    try:
        # 1. 
        device = Device.query.get(device_id)
        if not device:
            logger.warning(f" {admin_user.id}  DB ID: {device_id}")
            return jsonify({"success": False, "message": ""}), 404
        
        device_owner_id = device.user_id
        logger.info(f" DB ID: {device_id}  ID: {device_owner_id}.  {admin_user.id} ")

        # 2.  AdsPower 
        if not device.adspower_account_id:
            logger.warning(f" DB ID: {device_id}  AdsPower  ()")
            try:
                db.session.delete(device)
                db.session.commit()
                return jsonify({"success": True, "message": ""})
            except Exception as e:
                db.session.rollback()
                logger.error(f" {device_id} : {e}")
                return jsonify({"success": False, "message": ""}), 500

        # 3.  AdsPower 
        adspower_account = AdspowerAccount.query.get(device.adspower_account_id)
        if not adspower_account:
            logger.error(f" DB ID: {device_id}  AdsPower  ID: {device.adspower_account_id}  ()")
            try:
                db.session.delete(device)
                db.session.commit()
                return jsonify({"success": True, "message": "AdsPower"})
            except Exception as e:
                db.session.rollback()
                logger.error(f" {device_id} : {e}")
                return jsonify({"success": False, "message": ""}), 500

        # 4.  AdsPower 
        device_name_on_ads = device.device_name
        device_ip_on_ads = device.device_ip
        device_type_on_ads = device.device_type
        
        if not device_name_on_ads:
            logger.error(f" DB ID: {device_id}  AdsPower  (device_name) ()")
            # 
            # return jsonify({"success": False, "message": ""}), 400
            logger.warning(f" DB ID: {device_id}  device_name ()")
        elif not device_type_on_ads:
             logger.error(f" DB ID: {device_id}  (device_type) ()")
             # 
             logger.warning(f" DB ID: {device_id}  device_type ()")
        else:
            # 5.  AdsPower API  ()
            logout_message = " ()" # Default message
            logout_success = False # Default status
            try:
                adspower_api = get_adspower_api()
                logout_success, message = adspower_api.logout_device(adspower_account, device_name_on_ads, device_type_on_ads)
                logout_message = message # Update message with API result
                logger.info(f"adspower_api.logout_device( DB ID: {device_id}) : success={logout_success}, message='{message}'")

                if logout_success is not True:
                    # 
                    logger.error(f"AdsPower DB ID: {device_id} : {message}")
                    # 

            except Exception as e:
                logger.exception(f" logout_device  ( DB ID: {device_id}): {e}")
                # 
                logger.error(f"API: {str(e)}")
                logout_message = f": {str(e)}" # Update message for exception
                logout_success = False

        # 6.  ()
        try:
            db.session.delete(device)
            db.session.commit()
            logger.info(f" DB ID: {device_id}  {admin_user.id} ")
            
            # --  --
            final_message = ""
            if device_name_on_ads and device_type_on_ads: # Only mention logout if it was attempted
                if logout_success:
                    final_message += "  AdsPower "
                else:
                    # Include the specific reason/message from the logout attempt
                    final_message += f"  AdsPower : {logout_message}"
            elif not device_name_on_ads:
                final_message += " ()"
            elif not device_type_on_ads:
                final_message += " ()"
            # --  --
            
            return jsonify({
                "success": True,
                # "message": "" # 
                "message": final_message # 
            })
        except Exception as e:
            db.session.rollback()
            logger.error(f" {device_id} : {e}")
            return jsonify({"success": False, "message": ""}), 500

    except Exception as e:
        logger.exception(f" DB ID: {device_id} : {str(e)}")
        db.session.rollback() # Ensure rollback on top-level error
        return jsonify({"success": False, "message": ""}), 500

@api.route('/devices/<device_id>', methods=['DELETE'])
@login_required
def delete_device(device_id):
    """ - """
    try:
        user = g.user
        
        # 
        device = Device.query.filter_by(id=device_id, user_id=user.id).first()
        if not device:
            return jsonify({"success": False, "message": ""}), 404
        
        # 
        db.session.delete(device)
        db.session.commit()
        
        return jsonify({
            "success": True,
            "message": ""
        })
        
    except Exception as e:
        logger.exception(f": {str(e)}")
        return jsonify({"success": False, "message": ""}), 500

# 
@api.route('/2fa/get-code', methods=['POST'])
@login_required
@device_required
def get_2fa_code():
    """ADSpower"""
    try:
        user = g.user
        device = g.device
        logger.info(f"[2FA]  {user.id}  {device.id} ")
        
        # 
        success, device_info, message = device_auth_service.get_device_info(g.device.device_id)
        if not success:
            logger.warning(f"[2FA]  {user.id} : {message}")
            return jsonify({"success": False, "message": message}), 400
        
        # ADSpower
        adspower_account_id = device_info['adspower_account']['id']
        adspower_account = AdspowerAccount.query.get(adspower_account_id)
        
        if not adspower_account or not adspower_account.totp_secret:
            logger.warning(f"[2FA]  {user.id} : ADSpower {adspower_account_id} 2FA")
            return jsonify({"success": False, "message": "ADSpower2FA"}), 400
        
        # TOTP
        totp = pyotp.TOTP(adspower_account.totp_secret)
        code = totp.now()
        
        # ADSpower
        adspower_account.last_login = datetime.utcnow()
        db.session.commit()
        
        logger.info(f"[2FA]  {user.id} ADSpower {adspower_account.username} ")
        
        return jsonify({
            "success": True,
            "data": {
                "code": code,
                "expires_in": 30  # TOTP30
            }
        })
        
    except Exception as e:
        logger.exception(f"[2FA]  {g.user.id} 2FA: {str(e)}")
        return jsonify({"success": False, "message": ""}), 500

@api.route('/subscriptions', methods=['GET'])
@login_required
def get_user_subscription():
    """"""
    try:
        user = g.user
        logger.info(f"[]  {user.id} ")
        
        # 
        subscription = auth_service.get_user_subscription(user.id)
        
        # 
        history = Subscription.query.filter_by(
            user_id=user.id
        ).order_by(
            Subscription.created_at.desc()
        ).all()
        
        logger.info(f"[]  {user.id}  {len(history)} ")
        
        return jsonify({
            "success": True,
            "data": {
                "current": subscription.to_dict() if subscription else None,
                "history": [sub.to_dict() for sub in history]
            }
        })
        
    except Exception as e:
        logger.exception(f"[]  {g.user.id} : {str(e)}")
        return jsonify({"success": False, "message": ""}), 500

# 
@api.route('/payments/create', methods=['POST'])
@login_required
def create_payment():
    """ ( Epay, 0, )"""
    user_id = g.user.id
    data = request.get_json()
    if not data:
        return jsonify({'success': False, 'message': ''}), 400

    plan_code = data.get('plan_code')
    payment_gateway = data.get('gateway', 'epay') 
    payment_type = data.get('type', 'alipay') 

    if not plan_code:
        return jsonify({'success': False, 'message': ''}), 400

    # 
    subscription_type = SubscriptionType.query.filter_by(code=plan_code).first()
    if not subscription_type:
        return jsonify({'success': False, 'message': ''}), 404

    # 
    final_price = (subscription_type.price * (subscription_type.discount / 100.0)) if subscription_type.discount is not None and subscription_type.discount < 100 else subscription_type.price
    amount_str = "{:.2f}".format(final_price)

    # ---  0  ---
    # ()
    # --- 0  ---
    
    # ---  ( else) ---
    # else: # <--- 
    logger.info(f"[]  {user_id}  {plan_code} ({final_price:.2f}) {payment_gateway} ...")
    # 
    redirect_url = None
    payment = None
    message = ""
    epay_api_data = None # <--  mapi 
    html_form = None     # <--  submit.php  HTML 

    if payment_gateway == 'epay':
        epay_service = EpayService() 
        # ---  Submit  --- 
        payment, html_form = epay_service.create_payment_request( # <-- 
            user_id=user_id,
            plan_id=plan_code, 
            amount=amount_str,
            payment_type=payment_type,
            mode='submit' # <--  submit
        )
        # ---  Submit  --- 
        if payment and html_form:
            message = " submit ..." # <-- 
        elif not payment and isinstance(html_form, dict) and not html_form.get('success', True): # Check if error dict returned
             #  create_payment_request  ()
             message = html_form.get('message', ' submit ')
             logger.error(f"Epay submit : {message}")
             payment = None 
             html_form = None 
        else:
             # 
             message = f" submit  (Payment: {bool(payment)}, HTML Form: {bool(html_form)})"
             logger.error(message)
             payment = None
             html_form = None 
            
    elif payment_gateway == 'alipay':
        # 
        return jsonify({'success': False, 'message': ''}), 501 
    else:
        return jsonify({'success': False, 'message': ''}), 400

    # ---  payment  html_form --- 
    if not payment or not html_form:
        logger.error(f"[]  (: {payment_gateway})")
        return jsonify({
            'success': False,
            'message': ''
        }), 500

    # ---  html_form  JSON --- # Dedent this block
    # This block should execute only if the 'epay' path succeeded and payment/html_form are valid
    return jsonify({
        'success': True,
        'message': '...',
        'activated_directly': False, # False because this path handles paid plans
        'data': {
            'payment_id': payment.payment_id,
            'order_id': payment.order_id,
            'html_form': html_form,
            'gateway': payment_gateway, # payment_gateway was defined before the if/elif/else
        }
    }), 200

@api.route('/payments/epay/notify', methods=['GET', 'POST'])
def epay_notify():
    """"""
    params = request.args.to_dict() # GETPOST
    logger.info(f"[Epay Notify] : {params}")

    try:
        # --- 1.  --- 
        #  verify_notify  (bool, str)
        is_valid, message = epay_service.verify_notify(params)

        if not is_valid:
            logger.warning(f"[Epay Notify] : {message}")
            #  'fail' 
            return "fail - invalid sign", 400

        # --- 2.  --- 
        out_trade_no = params.get('out_trade_no')
        epay_trade_no = params.get('trade_no')
        amount_str = params.get('money')
        trade_status = params.get('trade_status')

        if not all([out_trade_no, epay_trade_no, amount_str, trade_status]):
            logger.error("[Epay Notify] ")
            return "fail - missing params", 400

        # --- 3.  () --- 
        if trade_status == 'TRADE_SUCCESS':
            logger.info(f"[Epay Notify]  {out_trade_no} ...")
            #  ( payment_service)
            # Note: Ensure payment_service is accessible here. If not instantiated globally, do it here:
            payment_service = PaymentService() 
            success, process_message = payment_service.process_epay_payment(
                out_trade_no=out_trade_no,
                epay_trade_no=epay_trade_no,
                amount_str=amount_str
            )
            if success:
                logger.info(f"[Epay Notify]  {out_trade_no} : {process_message}")
                #  "success" 
                return "success", 200
            else:
                logger.error(f"[Epay Notify]  {out_trade_no} : {process_message}")
                #  "success" 
                return "success", 200
        elif trade_status == 'TRADE_CLOSED':
            logger.info(f"[Epay Notify]  {out_trade_no} ")
            return "success", 200
        else:
            logger.warning(f"[Epay Notify]  {out_trade_no}  {trade_status}")
            return "success", 200

    except Exception as e:
        logger.exception("[Epay Notify] ")
        #  "fail" 
        return "fail - exception", 500

@api.route('/payments/alipay/notify', methods=['POST'])
def alipay_notify():
    """
    
    
    """
    try:
        # 
        data = request.form.to_dict()
        logger.info(f"[] : {json.dumps(data, ensure_ascii=False)}")
        
        # 
        verified, payment = alipay_service.verify_payment(data)
        
        if not verified:
            logger.error("[] ")
            return 'fail', 400
        
        # 
        logger.info(f"[] :  {payment.order_id} ")
        return 'success', 200
    except Exception as e:
        logger.error(f"[] : {str(e)}")
        return 'fail', 500

@api.route('/payments/status/<order_id>', methods=['GET'])
@login_required
def query_payment_status(order_id):
    """ ()"""
    #  g 
    user = g.user
    
    logger.info(f"[]  {g.user.id}  {order_id} ") #  g.user.id
    
    try:
        payment = Payment.query.filter_by(order_id=order_id, user_id=user.id).first()
    
        # --- ADD CHECK FOR NONE --- 
        if payment is None:
            logger.error(f"[]  {order_id} ")
            return jsonify({'success': False, 'message': ''}), 404
        # --- END CHECK --- 

        # --- ADD: Get plan_name ---
        plan_name = ''
        if payment.plan_id:
            sub_type = SubscriptionType.query.filter_by(code=payment.plan_id).first()
            if sub_type:
                plan_name = sub_type.name
            else:
                #  plan_id plan_id
                logger.warning(f"[]  {order_id}  plan_id '{payment.plan_id}'  SubscriptionType ")
                plan_name = payment.plan_id # Fallback to plan_id code
        # --- END ADD ---

        response_data = {
            'success': True,
            'status': payment.status, # paid, unpaid, failed
            'order_id': payment.payment_id,
            'plan_id': payment.plan_id, # <---  plan_id  plan_code
            'plan_name': plan_name, # <--- ADD plan_name
            'amount': str(payment.amount), # Decimal
            'created_at': payment.created_at.isoformat() + 'Z',
        }
        if payment.paid_at:
            response_data['paid_at'] = payment.paid_at.isoformat() + 'Z'

        return jsonify(response_data)

    except Exception as e:
        logger.exception(f"[]  {order_id} : {str(e)}")
        return jsonify({'success': False, 'message': ''}), 500

@api.route('/payments/result', methods=['GET'])
def payment_result():
    """API ()
    
    
    """
    # 
    order_id = request.args.get('out_trade_no')
    
    if not order_id:
        return jsonify({'success': False, 'message': ''}), 400
    
    # 
    payment = Payment.query.filter_by(payment_id=order_id).first() #  payment_id 
    
    if not payment:
        return jsonify({'success': False, 'message': ''}), 404
    
    # ---  alipay_service  --- 
    # payment, message = alipay_service.query_payment(order_id)
    logger.info(f"[]  {order_id} : {payment.status}")
    
    # 
    subscription = None
    if payment and payment.subscription_id:
        subscription = Subscription.query.get(payment.subscription_id)
    
    # 
    response = {
        'success': payment.status == 'paid', # 
        'message': '' if payment.status == 'paid' else ('' if payment.status == 'pending' else ''),
        'payment': {
            'order_id': payment.order_id,
            'amount': payment.amount,
            'status': payment.status,
            'created_at': payment.created_at.isoformat() if payment.created_at else None,
            'paid_at': payment.paid_at.isoformat() if payment.paid_at else None
        }
    }
    
    if subscription:
        response['subscription'] = {
            'id': subscription.id,
            'plan': subscription.plan,
            'start_date': subscription.start_date.isoformat() if subscription.start_date else None,
            'end_date': subscription.end_date.isoformat() if subscription.end_date else None
        }
    
    #  API  JSON 
    #  HTML  app.py  page_routes.py 
    #  templates/payment_result.html  API  JSON
    return jsonify(response), 200

# 
@api.route('/admin/users', methods=['GET'])
@admin_required
def admin_get_users():
    """"""
    page = request.args.get('page', 1, type=int)
    per_page = request.args.get('per_page', 20, type=int)
    search_query = request.args.get('search', None)
    subscription_filter = request.args.get('subscription', 'all') # all, active, inactive, expired

    try:
        query = User.query.options(db.joinedload(User.subscriptions))

        if search_query:
            query = query.filter(User.email.ilike(f'%{search_query}%'))

        #  ( end_date )
        now = datetime.utcnow()
        if subscription_filter == 'active':
            # 
            query = query.join(User.subscriptions).filter(Subscription.end_date > now)
        elif subscription_filter == 'inactive':
            # 
            # 
            # query = query.outerjoin(User.subscriptions).filter(Subscription.id == None)
            # : 
            # This is complex with SQLAlchemy. Let's focus on 'active' and 'expired' for now.
            pass # inactive
        elif subscription_filter == 'expired':
            #  ()
            # 
            subq_active = db.session.query(User.id).join(User.subscriptions).filter(Subscription.end_date > now).subquery()
            query = query.filter(User.id.notin_(subq_active))
            # Ensure they have at least one subscription (otherwise they are inactive/never subscribed)
            # query = query.join(User.subscriptions) # This might exclude users with only expired subs

        pagination = query.order_by(User.created_at.desc()).paginate(page=page, per_page=per_page, error_out=False)
        users = pagination.items
        total = pagination.total

        users_list = []
        for user in users:
            # 
            latest_subscription = Subscription.query.filter_by(user_id=user.id).order_by(Subscription.end_date.desc()).first()
            
            #  end_date 
            subscription_status = ''
            plan_name = None
            end_date_iso = None
            if latest_subscription:
                plan_name = latest_subscription.plan
                end_date_iso = latest_subscription.end_date.isoformat() + 'Z'
                if latest_subscription.end_date > now:
                    subscription_status = ''
                else:
                    subscription_status = ''

            users_list.append({
                'id': user.id,
                'email': user.email,
                'is_admin': user.is_admin,
                'is_active': user.is_active,
                'created_at': user.created_at.isoformat() if user.created_at else None,
                'last_login': user.last_login.isoformat() if user.last_login else None,
                'subscription_plan': plan_name, #  plan_name  plan
                'subscription_status': subscription_status, #  end_date 
                'subscription_end_date': end_date_iso # 
            })

        return jsonify({
            'success': True,
            'users': users_list,
            'pagination': {
                'page': pagination.page,
                'per_page': pagination.per_page,
                'total_pages': pagination.pages,
                'total_items': pagination.total
            }
        }), 200

    except Exception as e:
        logger.exception(f"[Admin] : {e}")
        return jsonify({'success': False, 'message': f': {str(e)}'}), 500

@api.route('/admin/users/<int:user_id>', methods=['PUT'])
@admin_required
def admin_update_user(user_id):
    """"""
    data = request.get_json()
    if not data:
        return jsonify({'success': False, 'message': ''}), 400

    user = User.query.get(user_id)
    if not user:
        return jsonify({'success': False, 'message': ''}), 404

    # 
    admin_user = g.user
    if admin_user.id == user.id and 'is_admin' in data and data['is_admin'] != user.is_admin:
         return jsonify({'success': False, 'message': ''}), 403

    # 
    updated = False
    if 'email' in data and data['email'] != user.email:
        # 
        existing_user = User.query.filter(User.email == data['email'], User.id != user_id).first()
        if existing_user:
            return jsonify({'success': False, 'message': ''}), 409
        user.email = data['email']
        # 
        # user.is_email_verified = False 
        updated = True

    if 'is_admin' in data and isinstance(data['is_admin'], bool) and data['is_admin'] != user.is_admin:
        user.is_admin = data['is_admin']
        updated = True
        
    if 'is_active' in data and isinstance(data['is_active'], bool) and data['is_active'] != user.is_active:
        user.is_active = data['is_active']
        updated = True
        
    # 
    if 'is_email_verified' in data and isinstance(data['is_email_verified'], bool) and data['is_email_verified'] != user.is_email_verified:
        user.is_email_verified = data['is_email_verified']
        if user.is_email_verified:
            user.email_verified_at = datetime.utcnow()
        updated = True
        logger.info(f" {admin_user.email}  {user.email}  {'' if user.is_email_verified else ''}")
        
    # 
    if 'new_password' in data and data['new_password']:
        # 
        is_valid, msg = auth_service.validate_password(data['new_password'])
        if not is_valid:
            return jsonify({'success': False, 'message': f': {msg}'}), 400
            
        # 
        user.set_password(data['new_password'])
        updated = True
        logger.info(f" {admin_user.email}  {user.email} ")

    if updated:
        try:
            db.session.commit()
            logger.info(f" {admin_user.email}  {user.email} ")
            return jsonify({'success': True, 'message': '', 'user': user.to_dict()})
        except Exception as e:
            db.session.rollback()
            logger.error(f" {user_id} : {e}", exc_info=True)
            return jsonify({'success': False, 'message': f': {e}'}), 500
    else:
        return jsonify({'success': True, 'message': '', 'user': user.to_dict()})

@api.route('/admin/users/<int:user_id>/details', methods=['GET'])
@admin_required
def admin_get_user_details(user_id):
    """"""
    try:
        user = User.query.get_or_404(user_id)
        
        # 
        subscriptions = Subscription.query.filter_by(user_id=user_id).order_by(Subscription.start_date.desc()).all()
        subscriptions_data = []
        for sub in subscriptions:
            # 
            status = '' if sub.end_date < datetime.utcnow() else ''
            plan_type = SubscriptionType.query.filter_by(code=sub.plan).first()
            subscriptions_data.append({
                'id': sub.id,
                'plan': sub.plan,
                'plan_name': plan_type.name if plan_type else sub.plan,
                'start_date': sub.start_date.isoformat() + 'Z',
                'end_date': sub.end_date.isoformat() + 'Z',
                'price': sub.price,
                'max_devices': sub.max_devices,
                'status': status, # 
                'payment_id': sub.payment_id,
                'created_at': sub.created_at.isoformat() + 'Z'
            })

        # 
        devices = Device.query.filter_by(user_id=user_id).all()
        devices_data = [{
            'id': d.id,
            'name': d.device_name,
            'ip_address': d.device_ip,
            'type': d.device_type,
            'last_login': d.last_login.isoformat() + 'Z' if d.last_login else None,
            'created_at': d.created_at.isoformat() + 'Z',
            'adspower_account_id': d.adspower_account_id,
            'account_username': d.adspower_account.username if d.adspower_account else 'N/A'
        } for d in devices]

        # 
        payments = Payment.query.filter_by(user_id=user_id).order_by(Payment.created_at.desc()).limit(20).all() # Limit recent payments
        payments_data = [{
            'id': p.id,
            'order_id': p.order_id,
            'amount': p.amount,
            'status': p.status,
            'payment_method': p.payment_method,
            'created_at': p.created_at.isoformat() + 'Z',
            'paid_at': p.paid_at.isoformat() + 'Z' if p.paid_at else None,
            'plan_id': p.plan_id,
            'subscription_days': p.subscription_days
        } for p in payments]

        #  (10)
        login_sessions = LoginSession.query.filter_by(user_id=user_id).order_by(LoginSession.login_time.desc()).limit(10).all()
        sessions_data = [{
            'id': s.id,
            'login_time': s.login_time.isoformat() + 'Z' if s.login_time else None,
            'ip_address': s.ip_address,
            'user_agent': s.user_agent,
            # 'status': s.status, # LoginSession status, not subscription status <--  status
            'completed_time': s.completed_time.isoformat() + 'Z' if s.completed_time else None, # 
            'adspower_account_id': s.adspower_account_id,
            'account_username': s.adspower_account.username if s.adspower_account else 'N/A'
        } for s in login_sessions]

        user_data = user.to_dict()

        return jsonify({
            'success': True,
            'user': user_data,
            'subscriptions': subscriptions_data,
            'devices': devices_data,
            'payments': payments_data,
            'login_sessions': sessions_data
        }), 200

    except NotFound:
        logger.warning(f"[Admin] : {user_id}")
        return jsonify({'success': False, 'message': ''}), 404
    except Exception as e:
        logger.exception(f"[Admin]  {user_id} : {e}")
        return jsonify({'success': False, 'message': f': {str(e)}'}), 500

@api.route('/admin/accounts/adspower', methods=['GET'])
@admin_required
def admin_get_adspower_accounts():
    """[API] ADSpower
    
    ADSpower
    
    :
    {
        "success": true/false,
        "message": "",
        "accounts": [
            {
                "id": ID,
                "username": "",
                "current_devices": ,
                "max_devices": ,
                "is_active": ,
                "subscription_type": "",
                "last_login": ""
            }
        ]
    }
    """
    try:
        admin_user = g.user
        logger.info(f"[]  {admin_user.id} ({admin_user.email}) AdsPower")
        
        accounts = AdspowerAccount.query.all()
        result = []
        
        for account in accounts:
            result.append({
                "id": account.id,
                "username": account.username,
                "current_devices": account.current_devices,
                "max_devices": account.max_devices,
                "is_active": account.is_active,
                "subscription_type": account.subscription_type or "",
                "last_login": account.last_login.isoformat() if account.last_login else None,
                "created_at": account.created_at.isoformat() if account.created_at else None
            })
        
        logger.info(f"[]  {len(result)} AdsPower")
        
        return jsonify({
            "success": True,
            "accounts": result
        })
        
    except Exception as e:
        logger.exception(f"[] AdsPower: {str(e)}")
        return jsonify({"success": False, "message": f": {str(e)}"}), 500

@api.route('/admin/accounts/adspower', methods=['POST'])
@admin_required
def admin_add_adspower_account():
    """[API] ADSpower
    
    ADSpower
    
    :
    {
        "username": "ADSpower",
        "password": "ADSpower",
        "api_key": "API()",
        "totp_secret": "2FA()",
        "max_devices": (10),
        "subscription_type": "(monthly/student/trial/basic)",
        "cookies": "Cookies JSON  ()",
        "remarks": " ()"
    }
    
    :
    {
        "success": true/false,
        "message": "",
        "account": {}
    }
    """
    try:
        admin_user = g.user
        data = request.json
        
        logger.info(f"[]  {admin_user.id} AdsPower: {data.get('username')}")
        
        # 
        if not data.get('username') or not data.get('password'):
            logger.warning(f"[] AdsPower: username={bool(data.get('username'))}, password={bool(data.get('password'))}")
            return jsonify({"success": False, "message": ""}), 400
        
        # 
        if AdspowerAccount.query.filter_by(username=data['username']).first():
            logger.warning(f"[] AdsPower: {data['username']}")
            return jsonify({"success": False, "message": ""}), 400
            
        #  cookies 
        cookies_str = None
        if 'cookies' in data:
            cookies_value = data['cookies']
            if isinstance(cookies_value, str):
                if cookies_value == "":
                    cookies_str = ""
                else:
                    try:
                        json.loads(cookies_value) #  JSON 
                        cookies_str = cookies_value
                    except json.JSONDecodeError:
                        logger.error(f"[]  {data['username']}  Cookies  JSON ")
                        return jsonify({"success": False, "message": " Cookie  JSON "}), 400
                    except Exception as parse_err:
                         logger.error(f"[]  {data['username']}  Cookies : {parse_err}")
                         return jsonify({"success": False, "message": f" Cookie : {parse_err}"}), 400
            elif isinstance(cookies_value, (list, dict)):
                try:
                    cookies_str = json.dumps(cookies_value)
                except Exception as json_err:
                    logger.error(f"[]  {data['username']}  Cookies : {json_err}")
                    return jsonify({"success": False, "message": f" Cookie : {json_err}"}), 400
            else:
                logger.warning(f"[]  {data['username']}  Cookies : {type(cookies_value)} Cookies")
        
        # 
        account = AdspowerAccount(
            username=data['username'],
            password=data['password'],
            api_key=data.get('api_key'),
            totp_secret=data.get('totp_secret'),
            max_devices=data.get('max_devices', 10),
            subscription_type=data.get('subscription_type'),
            cookies=cookies_str, # <--  cookies_str
            remarks=data.get('remarks'), # <--  remarks 
            is_active=True,
            current_devices=0,
            created_at=datetime.utcnow()
        )
        
        db.session.add(account)
        db.session.commit()
        
        logger.info(f"[]  {admin_user.id} AdsPower: {account.username}, ID: {account.id}")
        
        #  WebDriver Manager 
        try:
            manager = get_account_driver_manager()
            if manager:
                logger.info(f"[]  AccountWebDriverManager  ID: {account.id}")
                #  cookies
                manager.add_managed_account(
                    account_id=str(account.id),
                    username=account.username,
                    password=account.password, # 
                    totp_secret=account.totp_secret,
                    cookies=account.cookies #  cookies
                )
                logger.info(f"[] AccountWebDriverManager  {account.id} ")
            else:
                logger.warning(f"[] AccountWebDriverManager  {account.id} ")
        except Exception as e:
            # API
            logger.error(f"[]  AccountWebDriverManager  {account.id} : {e}", exc_info=True)

        # #  API  cookies  ()
        # # try:
        # #     if account.api_key:
        # #         adspower_api = AdspowerBrowser(api_key=account.api_key)
        # #         adspower_api.save_cookies_for_account(account.username)
        # #         logger.info(f"[] AdsPower {account.username} Cookies")
        # # except Exception as e:
        # #     logger.warning(f"[] AdsPower {account.username} cookies: {str(e)}")
        
        return jsonify({
            "success": True,
            "message": "ADSpower",
            "account": {
                "id": account.id,
                "username": account.username,
                "is_active": account.is_active,
                "max_devices": account.max_devices,
                "subscription_type": account.subscription_type or "",
                "remarks": account.remarks, #  remarks
                "created_at": account.created_at.isoformat()
                #  password, api_key, totp_secret, cookies
            }
        }), 201
        
    except Exception as e:
        logger.exception(f"[] AdsPower: {str(e)}")
        db.session.rollback()
        return jsonify({"success": False, "message": f": {str(e)}"}), 500

@api.route('/admin/accounts/adspower/<int:account_id>', methods=['DELETE'])
@admin_required
def admin_delete_adspower_account(account_id):
    """
    ADSpower
    ---
    # ... ( swagger )
    """
    account = AdspowerAccount.query.get(account_id)
    if not account:
        return jsonify(error=""), 404

    # 
    if account.devices and len(account.devices) > 0:
        logger.warning(f"[]  {account_id} ({account.username}) ({len(account.devices)})")
        # 
        # 
        return jsonify(error=f" {len(account.devices)} "), 400

    try:
        # ---  ---
        try:
            manager = get_account_driver_manager()
            if manager:
                logger.info(f"[]  AccountWebDriverManager  ID: {account_id}")
                manager.remove_managed_account(str(account_id))
                logger.info(f"[] AccountWebDriverManager  {account_id} ")
            else:
                logger.warning(f"[] AccountWebDriverManager  {account_id}")
        except Exception as e:
            # 
            logger.error(f"[]  AccountWebDriverManager  {account_id} : {e}", exc_info=True)
        # ---  ---

        username = account.username # 
        db.session.delete(account)
        db.session.commit()
        logger.info(f"[]  {g.user_id} AdsPower: {username} (ID: {account_id})")
        return jsonify(message="AdsPower"), 200
    except Exception as e:
        db.session.rollback()
        logger.error(f"[] AdsPower {account_id} : {e}", exc_info=True)
        return jsonify(error=f"AdsPower: {str(e)}"), 500

@api.route('/admin/accounts/adspower/<int:account_id>/toggle-status', methods=['POST'])
@admin_required
def admin_toggle_adspower_account_status(account_id):
    """ADSpower"""
    try:
        admin_user = g.user
        data = request.json
        logger.info(f"[]  {admin_user.id} AdsPower {account_id} ")
        
        if data is None or 'is_active' not in data:
            logger.warning(f"[] AdsPower: {data}")
            return jsonify({"success": False, "message": ""}), 400
        
        account = AdspowerAccount.query.get(account_id)
        if not account:
            logger.warning(f"[] AdsPower: {account_id}")
            return jsonify({"success": False, "message": ""}), 404
        
        # 
        old_status = account.is_active
        account.is_active = data['is_active']
        db.session.commit()
        
        logger.info(f"[]  {admin_user.id} AdsPower {account.username} (ID: {account_id})  {old_status}  {account.is_active}")
        
        #  AccountWebDriverManager 
        try:
            manager = get_account_driver_manager()
            if manager:
                if account.is_active:
                    logger.info(f"[]  AccountWebDriverManager  ID: {account_id}")
                    #  add_managed_account
                    manager.add_managed_account(
                        account_id=str(account.id),
                        username=account.username,
                        password=account.password,
                        totp_secret=account.totp_secret,
                        cookies=account.cookies
                    )
                    logger.info(f"[] AccountWebDriverManager  {account_id} ")
                else:
                    logger.info(f"[]  AccountWebDriverManager  ID: {account_id}")
                    #  remove_managed_account
                    manager.remove_managed_account(str(account_id))
                    logger.info(f"[] AccountWebDriverManager  {account_id} ")
            else:
                logger.warning(f"[] AccountWebDriverManager  {account_id} ")
        except Exception as e:
            # API
            logger.error(f"[]  AccountWebDriverManager  {account_id} : {e}", exc_info=True)

        return jsonify({
            "success": True, 
            "message": f": {'' if account.is_active else ''}"
        })
        
    except Exception as e:
        logger.exception(f"[] AdsPower {account_id} : {str(e)}")
        db.session.rollback()
        return jsonify({"success": False, "message": f": {str(e)}"}), 500

@api.route('/admin/accounts/adspower/<int:account_id>/cookies', methods=['GET'])
@admin_required
def admin_get_adspower_account_cookies(account_id):
    """ADSpowerCookies"""
    try:
        admin_user = g.user
        logger.info(f"[]  {admin_user.id} AdsPower {account_id} Cookies")
        
        account = AdspowerAccount.query.get(account_id)
        if not account:
            logger.warning(f"[] AdsPowerCookies: {account_id}")
            return jsonify({"success": False, "message": ""}), 404
        
        # Cookies
        cookies = []
        if account.cookies: # <--  cookies 
            try:
                cookies = json.loads(account.cookies) # <--  cookies 
                logger.info(f"[] AdsPower {account.username} (ID: {account_id}) Cookies")
            except Exception as e:
                logger.error(f"[] AdsPower {account.username} (ID: {account_id}) Cookies: {str(e)}")
                # 
                # cookies = account.cookies # 
                pass
        
        return jsonify({
            "success": True, 
            "cookies": cookies
        })
        
    except Exception as e:
        logger.exception(f"[] AdsPower {account_id} Cookies: {str(e)}")
        return jsonify({"success": False, "message": f": {str(e)}"}), 500

@api.route('/admin/devices/sync', methods=['POST'])
@admin_required
def admin_sync_devices():
    """"""
    # 
    devices = Device.query.all()
    
    if not devices:
        return jsonify({'message': ''}), 404
    
    # 
    updated = 0
    for device in devices:
        try:
            # Skip extra_info handling as the attribute doesn't exist
            # Simply increment the counter
            updated += 1
        except Exception as e:
            logger.error(f" {device.id} : {e}") # Updated log message
    
    db.session.commit()
    
    return jsonify({
        'message': f' {updated} ',
        'devices_updated': updated
    })

@api.route('/devices/sync', methods=['POST'])
@login_required
def sync_user_devices():
    """ - """
    # 
    return jsonify({
        'message': ''
    })

@api.route('/admin/accounts/adspower/<int:account_id>', methods=['PUT'])
@admin_required
def admin_update_adspower_account(account_id):
    """ADSpower"""
    try:
        admin_user = g.user
        data = request.json
        logger.info(f" #{account_id} : {data}")
        
        # 
        account = AdspowerAccount.query.get(account_id)
        if not account:
            return jsonify({"success": False, "message": ""}), 404
        
        # 
        if 'username' in data:
            account.username = data['username']
            logger.info(f" #{account_id} : {data['username']}")
        if 'password' in data and data['password']:
            account.password = data['password']
            logger.info(f" #{account_id} ")
        if 'api_key' in data:
            account.api_key = data['api_key']
            logger.info(f" #{account_id} API: {data['api_key']}")
        if 'totp_secret' in data:
            account.totp_secret = data['totp_secret']
            logger.info(f" #{account_id} TOTP: {data['totp_secret']}")
        if 'max_devices' in data:
            account.max_devices = data['max_devices']
            logger.info(f" #{account_id} : {data['max_devices']}")
        if 'subscription_type' in data:
            logger.info(f" #{account_id} : {data['subscription_type']} (: {account.subscription_type})")
            account.subscription_type = data['subscription_type']
        
        #  cookies 
        cookies_updated = False
        if 'cookies' in data:
            cookies_value = data['cookies']
            if isinstance(cookies_value, str):
                if cookies_value == "": # 
                    if account.cookies != cookies_value:
                        account.cookies = cookies_value
                        logger.info(f" #{account_id} Cookies ")
                        cookies_updated = True
                else:
                    #  JSON
                    try:
                        json.loads(cookies_value)
                        if account.cookies != cookies_value:
                            account.cookies = cookies_value
                            logger.info(f" #{account_id} Cookies - : {cookies_value[:100]}...")
                            cookies_updated = True
                    except json.JSONDecodeError:
                        logger.error(f" #{account_id}  Cookies  JSON ")
                        return jsonify({"success": False, "message": " Cookie  JSON "}), 400
                    except Exception as parse_err:
                        logger.error(f" #{account_id}  Cookies : {parse_err}")
                        return jsonify({"success": False, "message": f" Cookie : {parse_err}"}), 400
            elif isinstance(cookies_value, (list, dict)):
                # JSON
                try:
                    new_cookies_json = json.dumps(cookies_value)
                    if account.cookies != new_cookies_json:
                        account.cookies = new_cookies_json
                        logger.info(f" #{account_id} Cookies - : {account.cookies[:100]}...")
                        cookies_updated = True
                except Exception as json_err:
                    logger.error(f" #{account_id}  Cookies : {json_err}")
                    return jsonify({"success": False, "message": f" Cookie : {json_err}"}), 400
            else:
                logger.warning(f" #{account_id}  Cookies : {type(cookies_value)}")

        #  remarks  ( remarks)
        if 'remarks' in data:
            if account.remarks != data['remarks']:
                account.remarks = data['remarks']
                logger.info(f" #{account_id} Remarks: {account.remarks[:100]}...")
        
        # 
        db.session.commit()
        logger.info(f"AdsPower #{account.id} ({account.username}) ")
        
        # ===  WebDriver Manager ===
        #  add_managed_account Cookie
        # add_managed_account 
        try:
            logger.info(f" #{account_id}  WebDriver ...")
            manager = get_account_driver_manager()
            if manager:
                #  account 
                manager.add_managed_account(
                    account_id=str(account.id),
                    username=account.username,
                    password=account.password, # 
                    totp_secret=account.totp_secret,
                    cookies=account.cookies
                )
                logger.info(f" #{account_id}  WebDriver ")
            else:
                logger.warning(f" #{account_id} AccountWebDriverManager ")
        except Exception as manager_e:
            logger.error(f" #{account_id}  WebDriver : {manager_e}", exc_info=True)
            # 
        # === WebDriver Manager  ===

        #  ()
        updated_account = AdspowerAccount.query.get(account_id) # 
        return jsonify({
            "success": True,
            "message": "",
            "account": {
                "id": updated_account.id,
                "username": updated_account.username,
                "subscription_type": updated_account.subscription_type,
                "max_devices": updated_account.max_devices
                #  password, api_key, totp_secret, cookies 
            }
        })
    except Exception as e:
        logger.exception(f"AdsPower #{account_id} : {str(e)}")
        db.session.rollback()
        return jsonify({"success": False, "message": f": {str(e)}"}), 500

@api.route('/adspower/direct-login', methods=['POST'])
@login_required
def request_direct_adspower_login():
    """AdsPower ()
    
     DirectLoginService 
    """
    # Ensure g.user is populated by @login_required
    if not hasattr(g, 'user') or not g.user:
        logger.error("[API Direct Login] Endpoint reached without authenticated user in g")
        return jsonify({'success': False, 'message': ''}), 401
        
    user_id = g.user.id
    logger.info(f"[API Direct Login]  {user_id} ")

    # --- Use the new DirectLoginService --- 
    try:
        # Import the getter function for the new service
        from .services.direct_login_service import get_direct_login_service
        
        direct_login_service = get_direct_login_service()
        
        # Call the service method to prepare the login
        result = direct_login_service.prepare_login(user_id)
        
        # Determine status code based on result
        status_code = 500 # Default to internal error
        if result['success']:
            status_code = 200
        elif result.get('error_code') in ['no_subscription', 'DEVICE_LIMIT_REACHED']: # Add DEVICE_LIMIT_REACHED if handled by DirectLoginService
             status_code = 403 # Forbidden
        elif result.get('error_code') in ['no_account_available', 'account_verification_failed']:
            status_code = 503 # Service Unavailable
        elif result.get('error_code') in ['user_not_found', 'session_creation_failed']: # Added session error
             status_code = 400 # Bad Request or internal error? Let's use 400 for session fail for now.
        
        logger.info(f"[API Direct Login] DirectLoginService processed request for user {user_id}. Success: {result['success']}. Status Code: {status_code}")
        return jsonify(result), status_code

    except Exception as e:
         # Catch unexpected errors during service call
         logger.exception(f"[API Direct Login] Unexpected error calling DirectLoginService for user {user_id}: {e}")
         return jsonify({
            'success': False,
            'message': "",
            'error_code': 'service_call_exception',
            'data': None
         }), 500

# 
@api.errorhandler(404)
def not_found(error):
    """404"""
    return jsonify({"success": False, "message": ""}), 404

@api.errorhandler(405)
def method_not_allowed(error):
    """405"""
    return jsonify({"success": False, "message": ""}), 405

@api.errorhandler(500)
def internal_server_error(error):
    """500"""
    return jsonify({"success": False, "message": ""}), 500

@api.route('/auth/generate-totp', methods=['POST'])
def generate_totp():
    """TOTP
    
    :
    {
        "secret": "TOTP"
    }
    
    :
    {
        "success": true/false,
        "code": "",
        "remaining_seconds": 
    }
    """
    try:
        data = request.json
        if not data or 'secret' not in data:
            return jsonify({'success': False, 'message': ''}), 400
            
        secret = data['secret']
        
        # TOTP
        import pyotp
        import time
        
        totp = pyotp.TOTP(secret)
        code = totp.now()
        
        # 
        current_time = int(time.time())
        time_step = 30  # TOTP
        next_step = ((current_time // time_step) + 1) * time_step
        remaining_seconds = next_step - current_time
        
        return jsonify({
            'success': True,
            'code': code,
            'remaining_seconds': remaining_seconds
        }), 200
        
    except Exception as e:
        logger.exception(f"TOTP: {str(e)}")
        return jsonify({'success': False, 'message': f': {str(e)}'}), 500

@api.route('/subscriptions/current', methods=['GET'])
@login_required #  login_required 
def get_current_subscription():
    """"""
    user_id = g.user.id #  g  ID
    
    try:
        subscription = SubscriptionService.get_active_subscription(user_id)
        
        if not subscription:
            logger.info(f"[]  {user_id} ")
            return jsonify({'success': True, 'subscription': None, 'message': ''}), 200

        logger.info(f"[]  {user_id} : ID={subscription.id}, Plan={subscription.plan}, End={subscription.end_date}")
        
        # 
        plan_type = SubscriptionType.query.filter_by(code=subscription.plan).first()
        plan_name = plan_type.name if plan_type else subscription.plan # Fallback to code if name not found

        #  end_date  status 
        is_expired = subscription.end_date < datetime.utcnow()
        # status = 'expired' if is_expired else 'active' # No longer needed

        subscription_data = {
            'id': subscription.id,
            'user_id': subscription.user_id,
            'plan': subscription.plan,
            'plan_name': plan_name, # 
            'start_date': subscription.start_date.isoformat() + 'Z',
            'end_date': subscription.end_date.isoformat() + 'Z',
            'price': subscription.price,
            'max_devices': subscription.max_devices,
            # 'status': status, #  status 
            'is_expired': is_expired # 
        }
        
        return jsonify({'success': True, 'subscription': subscription_data}), 200
        
    except Exception as e:
        logger.exception(f"[]  {user_id} : {e}")
        return jsonify({'success': False, 'message': f': {str(e)}'}), 500

"""
API
"""

@api.route('/adspower/pools', methods=['GET', 'POST'])
@api.route('/adspower/pools/<int:pool_id>', methods=['DELETE'])
@api.route('/adspower/assign-account', methods=['POST'])
@api.route('/adspower/unassign-account', methods=['POST'])
@api.route('/adspower/balance-pools', methods=['POST'])
@admin_required
def deprecated_pool_apis():
    """API
    
    :
    {
        "success": false,
        "message": "APIAPI"
    }
    """
    logger.warning(f"API: {request.path}")
    return jsonify({
        "success": False,
        "message": "APIAPI"
    }), 410

@api.route('/adspower/sync-accounts', methods=['POST'])
@admin_required
def sync_adspower_accounts():
    """ADSpower"""
    try:
        # ADSpower API
        # 
        return jsonify({
            'success': True,
            'message': ''
        })
    except Exception as e:
        logger.error(f": {str(e)}")
        return jsonify({
            'success': False,
            'message': f': {str(e)}'
        }), 500

@api.route('/adspower/login-info', methods=['GET'])
@login_required
def get_adspower_login_info():
    """
    ADSpower
    
    :
    - Authorization: Bearer <token>
    
    :
    {
        "success": true/false,
        "message": "",
        "data": {
            "login_token": "",
            "username": "ADSpower",
            "password": "ADSpower",
            "totp_secret": "2FA",
            "login_url": "URL"
        }
    }
    """
    try:
        user = g.user
        
        # auth_service
        login_info = auth_service.get_adspower_login_info(user.id)
        
        if not login_info:
            return jsonify({
                "success": False, 
                "message": "ADSpower"
            }), 400
        
        return jsonify(login_info)
    
    except Exception as e:
        logger.exception(f"ADSpower: {str(e)}")
        return jsonify({
            "success": False, 
            "message": f": {str(e)}"
        }), 500

# APIAPI
@api.route('/admin/accounts/adspower/<int:account_id>/subscription-type', methods=['POST'])
@admin_required
def set_adspower_account_subscription_type(account_id):
    """ADSpower
    
    :
    {
        "subscription_type": "monthly" // 
    }
    
    :
    {
        "success": true/false,
        "message": ""
    }
    """
    try:
        data = request.json
        if not data or 'subscription_type' not in data:
            return jsonify({
                "success": False,
                "message": ""
            }), 400
        
        subscription_type = data['subscription_type']
        
        # 
        if subscription_type:
            subscription_type_obj = SubscriptionType.query.filter_by(code=subscription_type).first()
            if not subscription_type_obj and subscription_type not in ['monthly', 'student', 'trial', 'basic']:
                return jsonify({
                    "success": False,
                    "message": f": {subscription_type}"
                }), 400
        
        # 
        account = AdspowerAccount.query.get(account_id)
        if not account:
            return jsonify({
                "success": False,
                "message": "AdsPower"
            }), 404
        
        # 
        account.subscription_type = subscription_type
        db.session.commit()
        
        return jsonify({
            "success": True,
            "message": ""
        })
    except Exception as e:
        db.session.rollback()
        logger.error(f"AdsPower: {e}")
        return jsonify({
            "success": False,
            "message": f": {str(e)}"
        }), 500

@api.route('/admin/accounts/adspower/batch-set-subscription', methods=['POST'])
@admin_required
def batch_set_adspower_subscription():
    """AdsPower
    
    :
    {
        "account_ids": [1, 2, 3],  // ID
        "subscription_type": "monthly"  // 
    }
    
    :
    {
        "success": true/false,
        "message": "",
        "success_count": 3,  // 
        "failed_count": 0    // 
    }
    """
    try:
        data = request.json
        if not data or 'account_ids' not in data or 'subscription_type' not in data:
            return jsonify({
                "success": False,
                "message": ""
            }), 400
        
        account_ids = data['account_ids']
        subscription_type = data['subscription_type']
        
        # ID
        if not account_ids:
            return jsonify({
                "success": False,
                "message": "ID"
            }), 400
        
        # 
        if subscription_type:
            subscription_type_obj = SubscriptionType.query.filter_by(code=subscription_type).first()
            if not subscription_type_obj and subscription_type not in ['monthly', 'student', 'trial', 'basic']:
                return jsonify({
                    "success": False,
                    "message": f": {subscription_type}"
                }), 400
                
        # 
        accounts = AdspowerAccount.query.filter(AdspowerAccount.id.in_(account_ids)).all()
        
        # 
        success_count = 0
        failed_ids = []
        
        # 
        for account in accounts:
            try:
                account.subscription_type = subscription_type
                success_count += 1
            except Exception as e:
                logger.error(f" {account.id} : {e}")
                failed_ids.append(account.id)
        
        # 
        db.session.commit()
        
        failed_count = len(account_ids) - success_count
        
        return jsonify({
            "success": True,
            "message": f": {success_count} , {failed_count} ",
            "success_count": success_count,
            "failed_count": failed_count,
            "failed_ids": failed_ids if failed_ids else None
        })
    except Exception as e:
        db.session.rollback()
        logger.error(f"AdsPower: {e}")
        return jsonify({
            "success": False,
            "message": f": {str(e)}"
        }), 500

# AdsPowerAPI
@api.route('/admin/accounts/adspower/<int:account_id>', methods=['GET', 'PUT', 'DELETE'])
@admin_required
def admin_manage_adspower_account(account_id):
    """AdsPower - 
    
    GET: 
    :
    {
        "success": true/false,
        "message": "",
        "data": {
            "id": ID,
            "username": "",
            "api_key": "API Key",
            "totp_secret": "TOTP",
            "max_devices": ,
            "subscription_type": "",
            "created_at": "",
            "device_count": 
        }
    }
    
    PUT: 
    :
    {
        "username": "",
        "password": "", // 
        "api_key": "API Key",
        "totp_secret": "TOTP",
        "max_devices": ,
        "subscription_type": ""
    }
    
    DELETE: 
    """
    account = AdspowerAccount.query.get(account_id)
    if not account:
        return jsonify({"success": False, "message": f"ID {account_id} "}), 404
    
    # GET - 
    if request.method == 'GET':
        # 
        device_count = Device.query.filter_by(adspower_account_id=account_id).count()
        
        return jsonify({
            "success": True,
            "data": {
                "id": account.id,
                "username": account.username,
                "api_key": account.api_key,
                "totp_secret": account.totp_secret,
                "max_devices": account.max_devices,
                "subscription_type": account.subscription_type,
                "created_at": account.created_at.isoformat() if account.created_at else None,
                "device_count": device_count
            }
        })
    
    # PUT - 
    elif request.method == 'PUT':
        try:
            data = request.json
            logger.info(f" #{account_id} : {data}")
            
            # 
            if 'username' in data:
                account.username = data['username']
                logger.info(f" #{account_id} : {data['username']}")
            if 'password' in data and data['password']:
                account.password = data['password']
                logger.info(f" #{account_id} ")
            if 'api_key' in data:
                account.api_key = data['api_key']
                logger.info(f" #{account_id} API: {data['api_key']}")
            if 'totp_secret' in data:
                account.totp_secret = data['totp_secret']
                logger.info(f" #{account_id} TOTP: {data['totp_secret']}")
            if 'max_devices' in data:
                account.max_devices = data['max_devices']
                logger.info(f" #{account_id} : {data['max_devices']}")
            if 'subscription_type' in data:
                logger.info(f" #{account_id} : {data['subscription_type']} (: {account.subscription_type})")
                account.subscription_type = data['subscription_type']
            
            #  cookies 
            if 'cookies' in data:
                cookies_value = data['cookies']
                if isinstance(cookies_value, str):
                    if cookies_value == "": # 
                        if account.cookies != cookies_value:
                            account.cookies = cookies_value
                            logger.info(f" #{account_id} Cookies ")
                    else:
                        #  JSON
                        try:
                            json.loads(cookies_value)
                            if account.cookies != cookies_value:
                                account.cookies = cookies_value
                                logger.info(f" #{account_id} Cookies - : {cookies_value[:100]}...")
                        except json.JSONDecodeError:
                            logger.error(f" #{account_id}  Cookies  JSON ")
                            return jsonify({"success": False, "message": " Cookie  JSON "}), 400
                        except Exception as parse_err:
                            logger.error(f" #{account_id}  Cookies : {parse_err}")
                            return jsonify({"success": False, "message": f" Cookie : {parse_err}"}), 400
                elif isinstance(cookies_value, (list, dict)):
                    # JSON
                    try:
                        new_cookies_json = json.dumps(cookies_value)
                        if account.cookies != new_cookies_json:
                            account.cookies = new_cookies_json
                            logger.info(f" #{account_id} Cookies - : {account.cookies[:100]}...")
                    except Exception as json_err:
                        logger.error(f" #{account_id}  Cookies : {json_err}")
                        return jsonify({"success": False, "message": f" Cookie : {json_err}"}), 400
                else:
                    logger.warning(f" #{account_id}  Cookies : {type(cookies_value)}")

            #  remarks  ( remarks)
            if 'remarks' in data:
                if account.remarks != data['remarks']:
                    account.remarks = data['remarks']
                    logger.info(f" #{account_id} Remarks: {account.remarks[:100]}...")
            
            # 
            db.session.commit()
            logger.info(f"AdsPower #{account.id} ({account.username}) ")
            
            # ===  WebDriver Manager ===
            #  add_managed_account Cookie
            # add_managed_account 
            try:
                logger.info(f" #{account_id}  WebDriver ...")
                manager = get_account_driver_manager()
                if manager:
                    #  account 
                    manager.add_managed_account(
                        account_id=str(account.id),
                        username=account.username,
                        password=account.password, # 
                        totp_secret=account.totp_secret,
                        cookies=account.cookies
                    )
                    logger.info(f" #{account_id}  WebDriver ")
                else:
                    logger.warning(f" #{account_id} AccountWebDriverManager ")
            except Exception as manager_e:
                logger.error(f" #{account_id}  WebDriver : {manager_e}", exc_info=True)
                # 
            # === WebDriver Manager  ===

            #  ()
            updated_account = AdspowerAccount.query.get(account_id) # 
            return jsonify({
                "success": True,
                "message": "",
                "account": {
                    "id": updated_account.id,
                    "username": updated_account.username,
                    "subscription_type": updated_account.subscription_type,
                    "max_devices": updated_account.max_devices
                    #  password, api_key, totp_secret, cookies 
                }
            })
        except Exception as e:
            logger.exception(f"AdsPower #{account_id} : {str(e)}")
            db.session.rollback()
            return jsonify({"success": False, "message": f": {str(e)}"}), 500
    
    # DELETE - 
    elif request.method == 'DELETE':
        try:
            # 
            devices = Device.query.filter_by(adspower_account_id=account_id).all()
            if devices:
                # adspower_account_idNULL
                for device in devices:
                    device.adspower_account_id = None
                    logger.info(f" #{device.id} AdsPower")
            
            # 
            db.session.delete(account)
            db.session.commit()
            
            logger.info(f"AdsPower #{account_id} ")
            return jsonify({
                "success": True,
                "message": ""
            })
            
        except Exception as e:
            logger.exception(f"AdsPower #{account_id} : {str(e)}")
            db.session.rollback()
            return jsonify({"success": False, "message": f": {str(e)}"}), 500

@api.route('/user/adspower-account', methods=['GET'])
@login_required
def get_user_adspower_account():
    """AdsPower
    
    :
    {
        "success": true/false,
        "message": "",
        "account": {
            "username": "ADSpower",
            "login_token": "",
            "totp_secret": "TOTP",
            "login_url": "URL"
        }
    }
    """
    try:
        user_id = g.user.id
        
        # AdsPower
        login_info = auth_service.get_adspower_login_info(user_id)
        
        if not login_info or not login_info.get('success'):
            # 
            message = "AdsPower"
            if login_info and login_info.get('message'):
                message = login_info.get('message')
            
            return jsonify({
                "success": False,
                "message": message
            }), 404
        
        # 
        return jsonify({
            "success": True,
            "message": "AdsPower",
            "account": login_info.get('data')
        })
        
    except Exception as e:
        logger.exception(f"AdsPower: {str(e)}")
        return jsonify({
            "success": False,
            "message": f": {str(e)}"
        }), 500

"""
API
"""
@api.route('/subscription-types', methods=['GET'])
@login_required
def get_subscription_types():
    """
    
    :
    {
        "success": true,
        "types": [
            {
                "id": 1,
                "code": "monthly",
                "name": "",
                "max_devices": 5,
                "price": 49.99,
                "discount": 100,
                "days": 30,
                "requirements": null,
                "is_public": true
            },
            ...
        ]
    }
    """
    try:
        user = g.user
        logger.info(f"[]  {user.id} ")
        
        # 
        subscription_types = SubscriptionType.query.all()
        
        # JSON
        types_data = []
        for type_obj in subscription_types:
            types_data.append({
                "id": type_obj.id,
                "code": type_obj.code,
                "name": type_obj.name,
                "max_devices": type_obj.max_devices,
                "price": type_obj.price,
                "discount": type_obj.discount,
                "days": type_obj.days,
                "requirements": type_obj.requirements,
                "is_public": type_obj.is_public
            })
        
        logger.info(f"[]  {len(types_data)} ")
        
        return jsonify({
            "success": True,
            "types": types_data
        })
    except Exception as e:
        logger.error(f"[] : {e}")
        return jsonify({
            "success": False,
            "message": f": {str(e)}"
        }), 500

@api.route('/subscription-types', methods=['POST'])
@admin_required
def add_subscription_type():
    """
    
    :
    {
        "code": "monthly",
        "name": "",
        "max_devices": 5,
        "price": 49.99,
        "discount": 100,
        "days": 30,
        "requirements": null,
        "is_public": true
    }
    
    :
    {
        "success": true,
        "message": "",
        "type_id": 1
    }
    """
    try:
        admin_user = g.user
        data = request.json
        
        logger.info(f"[]  {admin_user.id} : {data}")
        
        # 
        if not data or 'code' not in data or 'name' not in data:
            logger.warning(f"[] : {data}")
            return jsonify({
                "success": False,
                "message": ""
            }), 400
        
        # 
        existing_type = SubscriptionType.query.filter_by(code=data['code']).first()
        if existing_type:
            logger.warning(f"[]  '{data['code']}' ")
            return jsonify({
                "success": False,
                "message": f" '{data['code']}' "
            }), 400
        
        # 
        new_type = SubscriptionType(
            code=data['code'],
            name=data['name'],
            max_devices=data.get('max_devices', 1),
            price=data.get('price', 0),
            discount=data.get('discount', 100),
            days=data.get('days', 30),
            requirements=data.get('requirements'),
            is_public=data.get('is_public', True)
        )
        
        db.session.add(new_type)
        db.session.commit()
        
        logger.info(f"[]  {admin_user.id} : {data['code']} (ID: {new_type.id})")
        
        return jsonify({
            "success": True,
            "message": "",
            "type_id": new_type.id
        })
    except Exception as e:
        db.session.rollback()
        logger.error(f"[] : {e}")
        return jsonify({
            "success": False,
            "message": f": {str(e)}"
        }), 500

@api.route('/subscription-types/<int:type_id>', methods=['PUT'])
@admin_required
def update_subscription_type(type_id):
    """
    
    :
    {
        "code": "monthly",
        "name": "",
        "max_devices": 5,
        "price": 49.99,
        "discount": 100,
        "days": 30,
        "requirements": null,
        "is_public": true
    }
    
    :
    {
        "success": true,
        "message": ""
    }
    """
    try:
        admin_user = g.user
        data = request.json
        
        logger.info(f"[]  {admin_user.id}  ID: {type_id}")
        
        # 
        if not data:
            logger.warning(f"[] ")
            return jsonify({
                "success": False,
                "message": ""
            }), 400
        
        # 
        subscription_type = SubscriptionType.query.get(type_id)
        if not subscription_type:
            logger.warning(f"[]  ID: {type_id}")
            return jsonify({
                "success": False,
                "message": ""
            }), 404
        
        # 
        if 'code' in data and data['code'] != subscription_type.code:
            existing_type = SubscriptionType.query.filter_by(code=data['code']).first()
            if existing_type:
                logger.warning(f"[]  '{data['code']}' ")
                return jsonify({
                    "success": False,
                    "message": f" '{data['code']}' "
                }), 400
        
        # 
        changed_fields = []
        if 'code' in data:
            old_code = subscription_type.code
            subscription_type.code = data['code']
            changed_fields.append(f"code: {old_code} -> {data['code']}")
        if 'name' in data:
            old_name = subscription_type.name
            subscription_type.name = data['name']
            changed_fields.append(f"name: {old_name} -> {data['name']}")
        if 'max_devices' in data:
            old_max = subscription_type.max_devices
            subscription_type.max_devices = data['max_devices']
            changed_fields.append(f"max_devices: {old_max} -> {data['max_devices']}")
        if 'price' in data:
            old_price = subscription_type.price
            subscription_type.price = data['price']
            changed_fields.append(f"price: {old_price} -> {data['price']}")
        if 'discount' in data:
            old_discount = subscription_type.discount
            subscription_type.discount = data['discount']
            changed_fields.append(f"discount: {old_discount} -> {data['discount']}")
        if 'days' in data:
            old_days = subscription_type.days
            subscription_type.days = data['days']
            changed_fields.append(f"days: {old_days} -> {data['days']}")
        if 'requirements' in data:
            old_req = subscription_type.requirements
            subscription_type.requirements = data['requirements']
            changed_fields.append(f"requirements: {old_req} -> {data['requirements']}")
        if 'is_public' in data:
            old_public = subscription_type.is_public
            subscription_type.is_public = data['is_public']
            changed_fields.append(f"is_public: {old_public} -> {data['is_public']}")
        
        db.session.commit()
        
        logger.info(f"[]  {admin_user.id}  ID: {type_id}, : {', '.join(changed_fields)}")
        
        return jsonify({
            "success": True,
            "message": ""
        })
    except Exception as e:
        db.session.rollback()
        logger.error(f"[]  ID: {type_id} : {e}")
        return jsonify({
            "success": False,
            "message": f": {str(e)}"
        }), 500

@api.route('/subscription-types/<int:type_id>', methods=['DELETE'])
@admin_required
def delete_subscription_type(type_id):
    """
    
    :
    {
        "success": true,
        "message": ""
    }
    """
    try:
        admin_user = g.user
        logger.info(f"[]  {admin_user.id}  ID: {type_id}")
        
        # 
        subscription_type = SubscriptionType.query.get(type_id)
        if not subscription_type:
            logger.warning(f"[]  ID: {type_id}")
            return jsonify({
                "success": False,
                "message": ""
            }), 404
        
        # 
        active_subscriptions = Subscription.query.filter_by(
            plan=subscription_type.code,
            status='active'
        ).count()
        
        if active_subscriptions > 0:
            logger.warning(f"[]  ID: {type_id} {active_subscriptions} ")
            return jsonify({
                "success": False,
                "message": f" {active_subscriptions} "
            }), 400
        
        # AdsPower
        accounts_using_type = AdspowerAccount.query.filter_by(
            subscription_type=subscription_type.code
        ).count()
        
        if accounts_using_type > 0:
            logger.warning(f"[]  ID: {type_id} {accounts_using_type} AdsPower")
            return jsonify({
                "success": False,
                "message": f" {accounts_using_type} AdsPower"
            }), 400
        
        # 
        code = subscription_type.code
        db.session.delete(subscription_type)
        db.session.commit()
        
        logger.info(f"[]  {admin_user.id}  ID: {type_id}, : {code}")
        
        return jsonify({
            "success": True,
            "message": ""
        })
    except Exception as e:
        db.session.rollback()
        logger.error(f": {e}")
        return jsonify({
            "success": False,
            "message": f": {str(e)}"
        }), 500

# Profile API
def handle_deprecated_profile_api():
    """Profile API"""
    return jsonify({
        'success': False,
        'message': 'ProfileAPI',
        'profiles': []
    }), 404

@api.route('/api/profiles', methods=['GET', 'POST'])
@login_required
def profiles_api():
    """Profile API"""
    return handle_deprecated_profile_api()

@api.route('/api/profiles/<int:profile_id>', methods=['GET', 'DELETE', 'PUT', 'PATCH'])
@login_required
def profile_detail_api(profile_id):
    """ProfileAPI"""
    return handle_deprecated_profile_api()

@api.route('/api/admin/accounts/adspower/batch-subscription-type', methods=['POST'])
@admin_required
def batch_update_adspower_account_subscription_type():
    """AdsPower
    
    :
    {
        "account_ids": [1, 2, 3],
        "subscription_type": "monthly"
    }
    
    :
    {
        "success": true,
        "message": "X",
        "updated_count": X
    }
    """
    try:
        data = request.json
        if not data:
            return jsonify({
                "success": False,
                "message": ""
            }), 400
        
        account_ids = data.get('account_ids')
        subscription_type = data.get('subscription_type')
        
        if not account_ids or not isinstance(account_ids, list) or len(account_ids) == 0:
            return jsonify({
                "success": False,
                "message": "account_ids"
            }), 400
        
        if not subscription_type:
            return jsonify({
                "success": False,
                "message": "subscription_type"
            }), 400
        
        # 
        subscription_type_obj = SubscriptionType.query.filter_by(code=subscription_type).first()
        if not subscription_type_obj:
            return jsonify({
                "success": False,
                "message": f" '{subscription_type}' "
            }), 400
        
        # 
        updated_accounts = AdspowerAccount.query.filter(AdspowerAccount.id.in_(account_ids)).all()
        updated_count = 0
        
        for account in updated_accounts:
            account.subscription_type = subscription_type
            updated_count += 1
        
        db.session.commit()
        
        return jsonify({
            "success": True,
            "message": f" {updated_count} ",
            "updated_count": updated_count
        })
    except Exception as e:
        db.session.rollback()
        logger.error(f": {e}")
        return jsonify({
            "success": False,
            "message": f": {str(e)}"
        }), 500

@api.route('/admin/devices/sync-from-adspower', methods=['POST'])
@admin_required
def sync_devices_from_adspower():
    """AdsPower

    AdsPower

    :
    {
        "success": true/false,
        "message": "",
        "data": {
            "devices_added": ,
            "devices_updated": ,
            "total_devices": 
        }
    }
    """
    try:
        # AdsPower
        accounts = AdspowerAccount.query.filter_by(is_active=True).all()
        if not accounts:
            return jsonify({
                "success": False,
                "message": "AdsPower"
            }), 404

        devices_added = 0
        devices_updated = 0
        total_devices = 0

        adspower_api = get_adspower_api() #  AdspowerAPI 

        for account in accounts:
            # Cookie (AdspowerAPI )
            if not account.cookies:
                logger.warning(f" {account.username}Cookies")
                continue

            try:
                #  AdspowerAPI 
                # get_devices_info  None
                devices = adspower_api.get_devices_info(account)

                if devices is None:
                    logger.error(f" {account.username}  (API  None)")
                    continue # 

                if not devices:
                    logger.info(f" {account.username} ")
                    # 0
                    account.current_devices = 0
                    account.last_check_time = int(time.time())
                    db.session.add(account) # 
                    continue # 

                #  ()
                account.current_devices = len(devices)
                account.last_check_time = int(time.time())
                db.session.add(account) # 

                # 
                for device_info in devices:
                    #  device_info  'id' 
                    if not isinstance(device_info, dict) or 'id' not in device_info:
                        logger.warning(f" ( {account.username}): {device_info}")
                        continue

                    device_id = device_info.get('id') #  AdsPower  ID
                    if not device_id:
                        logger.warning(f" ID  ( {account.username}): {device_info}")
                        continue

                    #  ( AdsPower  ID)
                    device = Device.query.filter_by(device_name=device_info['name'], device_type=device_info['device_type'], adspower_account_id=account.id).first()

                    if device:
                        # 
                        device.device_name = device_info.get('name', device.device_name)
                        device.adspower_account_id = account.id
                        device.device_ip = device_info.get('ip_address')
                        # Unknown ()
                        device.device_type = device_info.get('device_type') or device.device_type or 'Unknown' # <-- key

                        #  last_open 
                        last_open_str = device_info.get('last_open')
                        if last_open_str:
                            try:
                                # 
                                # AdsPower  'YYYY-MM-DD HH:MM' 
                                parsed_time = None
                                for fmt in ('%Y-%m-%d %H:%M', '%Y-%m-%d %H:%M:%S', '%Y/%m/%d %H:%M'):
                                    try:
                                        parsed_time = datetime.strptime(last_open_str, fmt)
                                        break
                                    except ValueError:
                                        continue
                                if parsed_time:
                                    device.last_login = parsed_time
                                else:
                                    logger.warning(f" {device_id}  last_open : {last_open_str}")
                            except Exception as date_e:
                                logger.warning(f" {device_id}  last_open  '{last_open_str}' : {date_e}")

                        db.session.add(device) # 
                        devices_updated += 1
                    else:
                        # 
                        logger.info(f" {account.username}  (ID: {device_id}) - : {device_info}")
                        user_id = None
                        admin_user = User.query.filter_by(is_admin=True).first()
                        if admin_user:
                            user_id = admin_user.id
                            logger.info(f" {device_id} : {admin_user.email} (ID: {user_id})")
                        else:
                                logger.error(f" {account.username} : {device_info}")
                                continue

                        new_device = Device(
                            user_id=user_id,
                            adspower_account_id=account.id,
                            device_name=device_info.get('name', 'Unknown Device'),
                            device_ip=device_info.get('ip_address', ''),
                            device_type=device_info.get('device_type', 'Unknown'), # <-- key
                            last_login=datetime.utcnow(),
                        )

                        #  last_open 
                        last_open_str = device_info.get('last_open')
                        if last_open_str:
                            try:
                                # 
                                parsed_time = None
                                for fmt in ('%Y-%m-%d %H:%M', '%Y-%m-%d %H:%M:%S', '%Y/%m/%d %H:%M'):
                                    try:
                                        parsed_time = datetime.strptime(last_open_str, fmt)
                                        break
                                    except ValueError:
                                        continue
                                if parsed_time:
                                    new_device.last_login = parsed_time
                            except Exception as date_e:
                                logger.warning(f" {device_id}  last_open  '{last_open_str}' : {date_e}")

                        db.session.add(new_device)
                        devices_added += 1

                    total_devices += 1

                logger.info(f" {account.username} : {len(devices)}")

            except Exception as e:
                logger.error(f" {account.username} : {str(e)}", exc_info=True) #  exc_info

        # 
        try:
            db.session.commit()
            logger.info("")
        except Exception as commit_e:
             logger.error(f": {commit_e}", exc_info=True)
             db.session.rollback()
             return jsonify({
                "success": False,
                "message": f": {str(commit_e)}"
             }), 500

        return jsonify({
            "success": True,
            "message": f": {devices_added}, : {devices_updated}, : {total_devices}",
            "data": {
                "devices_added": devices_added,
                "devices_updated": devices_updated,
                "total_devices": total_devices
            }
        })

    except Exception as e:
        db.session.rollback()
        logger.exception(f": {str(e)}")
        return jsonify({
            "success": False,
            "message": f": {str(e)}"
        }), 500

@api.route('/admin/devices/<device_id>', methods=['GET'])
@admin_required
def admin_get_device(device_id):
    """"""
    try:
        # 
        device = Device.query.get(device_id)
        if not device:
            return jsonify({"success": False, "message": ""}), 404
        
        # 
        user = User.query.get(device.user_id) if device.user_id else None
        
        # AdsPower
        adspower_account = None
        if device.adspower_account_id:
            adspower_account = AdspowerAccount.query.get(device.adspower_account_id)
            if adspower_account:
                adspower_account = {
                    'id': adspower_account.id,
                    'username': adspower_account.username,
                    'is_active': adspower_account.is_active,
                    'current_devices': adspower_account.current_devices,
                    'max_devices': adspower_account.max_devices
                }
        
        # IP - 
        ip_address = device.device_ip
        if ip_address:
            # IP - HTML
            import re
            # IP
            ip_match = re.search(r'(\d{1,3}\.\d{1,3}\.\d{1,3}\.\d{1,3}|[0-9a-f:]+)', ip_address)
            if ip_match:
                ip_address = ip_match.group(1)
            else:
                # HTML
                ip_address = re.sub(r'<[^>]*>?', '', ip_address).strip()
        
        # 
        device_info = {
            'id': device.id,
            'device_name': device.device_name,
            'device_ip': ip_address,
            'device_type': device.device_type,
            'last_login': device.last_login.isoformat() if device.last_login else None,
            'last_active': device.last_active.isoformat() if device.last_active else None,
            'created_at': device.created_at.isoformat() if device.created_at else None,
            'user': {
                'id': user.id if user else None,
                'email': user.email if user else None
            } if user else None, # userNone
            'adspower_account': adspower_account # adspower_accountNone
            # : user_id, user_email, adspower_account_id, adspower_username
            #  user['username']
            #  'extra' 
        }
        
        #  adspower_account  None None 
        if not adspower_account:
            device_info['adspower_account'] = None
            
        return jsonify({"success": True, "data": device_info})
        
    except Exception as e:
        logger.exception(f": {str(e)}")
        return jsonify({"success": False, "message": ""}), 500

@api.route('/api/subscriptions/create', methods=['POST'])
@login_required
def create_subscription():
    """
    
    :
    {
        "plan_code": "monthly",  // 
        "payment_id": "xxx",    // ID
        "price": 49.99          // 
    }
    
    :
    {
        "success": true,
        "message": "",
        "subscription": {
            ......
        }
    }
    """
    try:
        user = g.user
        data = request.json
        
        if not data or 'plan_code' not in data:
            return jsonify({
                "success": False,
                "message": ""
            }), 400
        
        plan_code = data.get('plan_code')
        payment_id = data.get('payment_id')
        price = data.get('price')
        
        # 
        from services import SubscriptionService
        subscription, message = SubscriptionService.create_subscription(
            user_id=user.id,
            plan_code=plan_code,
            payment_id=payment_id,
            price=price
        )
        
        if not subscription:
            return jsonify({
                "success": False,
                "message": message
            }), 400
        
        return jsonify({
            "success": True,
            "message": message,
            "subscription": subscription.to_dict()
        })
    except Exception as e:
        logger.error(f": {e}")
        return jsonify({
            "success": False,
            "message": f": {str(e)}"
        }), 500

@api.route('/adspower/check-login-status', methods=['GET'])
def check_adspower_login_status():
    token = request.args.get('token')
    if not token:
        return jsonify({'success': False, 'message': '', 'status': 'error'}), 400

    login_session = LoginSession.query.filter_by(login_token=token).first()

    if not login_session:
        return jsonify({'success': False, 'message': '', 'status': 'error'}), 404

    #  ( expiration_timestamp)
    now_utc_naive = datetime.now(timezone.utc).replace(tzinfo=None)
    if login_session.expiration_timestamp < now_utc_naive:
         #  status 
         logger.warning(f"LoginSession {login_session.id} has expired.")
         return jsonify({'success': False, 'message': '', 'status': 'expired'}), 410 # HTTP 410 Gone

    #  ( completed_time)
    if login_session.completed_time:
         logger.info(f"LoginSession {login_session.id} already completed.")
         return jsonify({'success': True, 'message': '', 'status': 'completed', 'loggedIn': True}), 200

    # ---  ---
    account = AdspowerAccount.query.get(login_session.adspower_account_id)
    if not account:
        logger.error(f"Associated AdspowerAccount {login_session.adspower_account_id} not found for session {login_session.id}.")
        return jsonify({'success': False, 'message': 'AdsPower', 'status': 'error'}), 500

    # 1. 
    known_devices_snapshot = []
    if login_session.known_devices_snapshot:
        try:
            known_devices_snapshot = json.loads(login_session.known_devices_snapshot)
            if not isinstance(known_devices_snapshot, list):
                logger.warning(f"LoginSession {login_session.id} known_devices_snapshot is not a list, treating as empty.")
                known_devices_snapshot = []
        except json.JSONDecodeError:
            logger.error(f"Failed to decode known_devices_snapshot for LoginSession {login_session.id}, treating as empty.")
            known_devices_snapshot = []
    logger.debug(f"Session {login_session.id}: Loaded {len(known_devices_snapshot)} devices from snapshot.")

    # 2. 
    adspower_api = get_adspower_api()
    current_devices = None
    try:
        logger.debug(f"Session {login_session.id}: Getting current devices for account {account.id}...")
        current_devices = adspower_api.get_devices_info(account)
    except Exception as e:
         logger.error(f"Error getting current devices for account {account.id} during check-login-status (session {login_session.id}): {e}", exc_info=True)
         #  pending 
         #  pending
         return jsonify({'success': False, 'message': f'', 'status': 'pending'}), 200

    if current_devices is None:
        logger.warning(f"get_devices_info returned None for account {account.id} during check-login-status (session {login_session.id}).")
        #  pending 
        #  pending
        return jsonify({'success': False, 'message': '', 'status': 'pending'}), 200
    logger.debug(f"Session {login_session.id}: Got {len(current_devices)} current devices from API.")

    # 3. 
    known_device_tuples = set()
    for d in known_devices_snapshot:
        if isinstance(d, dict):
            name = d.get('name')
            dtype = d.get('device_type') 
            if name and dtype: 
                known_device_tuples.add((name, dtype))
            else:
                 logger.warning(f"Snapshot device missing name or type in session {login_session.id}: {d}")
    logger.debug(f"Session {login_session.id}: Known device tuples from snapshot: {known_device_tuples}")

    newly_detected_devices = []
    for device in current_devices:
        if isinstance(device, dict):
            current_name = device.get('name')
            current_type = device.get('device_type')
            if current_name and current_type:
                if (current_name, current_type) not in known_device_tuples:
                    logger.info(f"Session {login_session.id}: Found potential new device: Name={current_name}, Type={current_type}")
                    newly_detected_devices.append(device)
            else:
                 logger.warning(f"Current device missing name or type in session {login_session.id}: {device}")
        else:
             logger.warning(f"Invalid device format in current_devices list for session {login_session.id}: {device}")

    # 4.  ()
    if newly_detected_devices:
        logger.info(f"New device detected for session {login_session.id}: {newly_detected_devices[0]}")
        return jsonify({
            'success': True,
            'status': 'new_device_detected', # 
            'message': '',
            'new_device': newly_detected_devices[0]
        }), 200
    else:
        logger.info(f"No new device detected for session {login_session.id}. Status remains pending.")
        return jsonify({
            'success': False, # 
            'status': 'pending', # 
            'message': ''
        }), 200

@api.route('/adspower/check-account-health', methods=['GET'])
def check_adspower_account_health():
    """AdsPower
    
    AdsPowerCookieWebDriver
    """
    try:
        # 
        user = get_current_user()
        
        if not user:
            return jsonify({
                'status': 'error',
                'message': 'Unauthorized'
            }), 401
            
        # 
        if not user.is_admin:
            return jsonify({
                'status': 'error',
                'message': 'Admin permission required'
            }), 403
            
        # ID
        account_id = request.args.get('account_id')
        
        if not account_id:
            return jsonify({
                'status': 'error',
                'message': 'Missing account_id parameter'
            }), 400
            
        try:
            account_id = int(account_id)
        except ValueError:
            return jsonify({
                'status': 'error',
                'message': 'Invalid account_id parameter'
            }), 400
            
        # AdsPower
        adspower_account = AdspowerAccount.query.get(account_id)
        
        if not adspower_account:
            return jsonify({
                'status': 'error',
                'message': 'AdsPower account not found'
            }), 404
            
        # WebDriver
        from .webdriver_pool import get_account_driver_manager
        driver_manager = get_account_driver_manager()
        
        # 
        account_status = driver_manager.get_account_status(account_id)
        
        # 
        from .adspower_api import get_adspower_api
        adspower_api = get_adspower_api()
        is_logged_in = adspower_api.check_account_login_status(adspower_account)
        
        # 
        try:
            devices_count = adspower_api.get_current_devices_count(adspower_account)
        except Exception as e:
            devices_count = None
            logger.error(f" {account_id} : {str(e)}")
        
        # 
        response_data = {
            'account_id': account_id,
            'username': adspower_account.username,
            'is_available': adspower_account.is_available,
            'current_devices': adspower_account.current_devices,
            'max_devices': adspower_account.max_devices,
            'last_check_time': adspower_account.last_check_time,
            'last_error': adspower_account.last_error,
            'driver_status': account_status,
            'is_logged_in': is_logged_in,
            'devices_count': devices_count,
            'check_time': int(time.time())
        }
        
        return jsonify({
            'status': 'success',
            'data': response_data
        })
            
    except Exception as e:
        logger.error(f"AdsPower: {str(e)}", exc_info=True)
        
        return jsonify({
            'status': 'error',
            'message': f'Failed to check account health: {str(e)}'
        }), 500

# API
@api.route('/adspower/check-login-status', methods=['GET'])
def check_login_status_api_alias():
    """API"""
    return check_adspower_login_status()

@api.route('/admin/accounts/adspower/<int:account_id>/refresh-count', methods=['POST'])
@admin_required
def admin_refresh_single_adspower_account_device_count(account_id):
    """AdsPower"""
    account = AdspowerAccount.query.get(account_id)
    if not account:
        return jsonify({"success": False, "message": ""}), 404

    logger.info(f" #{account_id} ({account.username}) ...")
    
    try:
        adspower_api = get_adspower_api()
        # 
        current_devices = adspower_api.get_current_devices_count(account)
        
        if current_devices is not None: # 
            logger.info(f" #{account_id} : {current_devices}")
            
            # 
            if account.current_devices != current_devices:
                 account.current_devices = current_devices
                 account.last_check_time = int(time.time()) # 
                 db.session.commit()
                 logger.info(f" #{account_id}  {current_devices}")
                 return jsonify({ "success": True, 
                                 "message": f" {account.username}  {current_devices}", 
                                 "current_devices": current_devices })
            else:
                 account.last_check_time = int(time.time()) # 
                 db.session.commit()
                 logger.info(f" #{account_id}  ({current_devices})")
                 return jsonify({ "success": True, 
                                 "message": f" {account.username}  ({current_devices})", 
                                 "current_devices": current_devices })
        else:
             #  get_current_devices_count  None
             logger.error(f" #{account_id}  (API  None)")
             return jsonify({"success": False, "message": "AdsPower"}), 500
             
    except Exception as e:
        logger.error(f" #{account_id} : {str(e)}", exc_info=True)
        db.session.rollback() # 
        return jsonify({"success": False, "message": f": {str(e)}"}), 500

# ===== API =====

@api.route('/devices/confirm-new', methods=['POST'])
def confirm_new_device():
    """"""
    data = request.json
    if not data or 'login_token' not in data or 'device' not in data:
        return jsonify({'success': False, 'message': ''}), 400

    token = data.get('login_token')
    new_device_info = data.get('device')

    if not isinstance(new_device_info, dict):
         return jsonify({'success': False, 'message': ''}), 400

    login_session = LoginSession.query.filter_by(login_token=token).first()

    if not login_session:
        return jsonify({'success': False, 'message': ''}), 404

    # 
    now = datetime.now(timezone.utc).replace(tzinfo=None)
    if login_session.expiration_timestamp < now: 
        logger.warning(f"Attempt to confirm device on expired session {login_session.id}")
        return jsonify({'success': False, 'message': ''}), 410

    #  ( completed_time)
    if login_session.completed_time:
         logger.warning(f"Attempt to re-confirm device for completed session {login_session.id}")
         return jsonify({'success': True, 'message': ''}), 200 # 

    # 
    user = User.query.get(login_session.user_id)
    if not user:
         logger.error(f"User {login_session.user_id} not found for session {login_session.id}")
         return jsonify({'success': False, 'message': ''}), 500

    # 
    active_subscription = auth_service.get_user_subscription(user.id) 
    if not active_subscription: 
         logger.warning(f"User {user.id} has no active subscription during device confirmation.")
         return jsonify({'success': False, 'message': ''}), 403

    current_device_count = Device.query.filter_by(user_id=user.id).count()
    max_devices_allowed = active_subscription.max_devices 
    if current_device_count >= max_devices_allowed:
        logger.warning(f"User {user.id} reached device limit ({current_device_count}/{max_devices_allowed}) during confirmation.")
        return jsonify({
            'success': False,
            'message': f' ({max_devices_allowed})'
        }), 403

    # ---  ---
    device_name = new_device_info.get('name')
    device_type = new_device_info.get('device_type')
    device_ip = new_device_info.get('ip_address')
    last_login_str = new_device_info.get('last_open')

    if not device_name or not device_type:
         logger.error(f"New device info missing name or type in session {login_session.id}: {new_device_info}")
         return jsonify({'success': False, 'message': ' ()'}), 400

    try:
        # 
        existing_device = Device.query.filter_by(
            user_id=user.id,
            device_name=device_name,
            device_type=device_type
        ).first()

        if existing_device:
            logger.info(f"Existing device found for user {user.id}. Updating last login.")
            existing_device.last_login = datetime.utcnow()
            existing_device.device_ip = device_ip
            existing_device.adspower_account_id = login_session.adspower_account_id
            db.session.add(existing_device)
        else:
            logger.info(f"Creating new device record for user {user.id}.")
            new_db_device = Device(
                user_id=user.id,
                adspower_account_id=login_session.adspower_account_id,
                device_name=device_name,
                device_type=device_type,
                device_ip=device_ip,
                last_login=datetime.utcnow()
            )
            db.session.add(new_db_device)

        #  ( completed_time)
        # : login_session.status = 'completed'
        login_session.completed_time = datetime.utcnow()
        db.session.add(login_session)

        # 
        db.session.commit()

        logger.info(f"Device confirmed and session {login_session.id} completed for user {user.id}.")
        return jsonify({'success': True, 'message': ''}), 200

    except Exception as e:
        db.session.rollback()
        logger.error(f"Error confirming device or updating session {login_session.id}: {e}", exc_info=True)
        return jsonify({'success': False, 'message': ''}), 500

# ===  API ===
@api.route('/devices/<int:device_db_id>/logout', methods=['POST'])
@login_required
def logout_device_api(device_db_id):
    """

    Args:
        device_db_id (int):  ID

    Returns:
        JSON: 
    """
    user = g.user
    logger.info(f" {user.id}  DB ID: {device_db_id}")

    # 1. 
    device = Device.query.filter_by(id=device_db_id, user_id=user.id).first()
    if not device:
        logger.warning(f" {user.id}  DB ID: {device_db_id}")
        return jsonify({"success": False, "message": ""}), 404

    # 2.  AdsPower 
    if not device.adspower_account_id:
        #  AdsPower 
        logger.warning(f" DB ID: {device_db_id}  AdsPower ") # Updated log
        try:
            db.session.delete(device) # Delete the record
            db.session.commit()
            return jsonify({"success": True, "message": ""}) # Updated message
        except Exception as e:
            db.session.rollback()
            logger.error(f" {device_db_id} : {e}") # Updated log
            return jsonify({"success": False, "message": ""}), 500

    # 3.  AdsPower 
    adspower_account = AdspowerAccount.query.get(device.adspower_account_id)
    if not adspower_account:
        logger.error(f" DB ID: {device_db_id}  AdsPower  ID: {device.adspower_account_id} ") # Updated log
        try:
            db.session.delete(device) # Delete the record
            db.session.commit()
            return jsonify({"success": True, "message": "AdsPower"}) # Updated message
        except Exception as e:
            db.session.rollback()
            logger.error(f" {device_db_id} : {e}") # Updated log
            return jsonify({"success": False, "message": ""}), 500

    # 4.  AdsPower  ( device_name)
    device_name_on_ads = device.device_name
    if not device_name_on_ads:
        logger.error(f" DB ID: {device_db_id}  AdsPower  (device_name)")
        return jsonify({"success": False, "message": ""}), 400

    # 4.1  IP  (device_ip)
    device_ip_on_ads = device.device_ip
    if not device_ip_on_ads:
        #  IP  ( IP)
        logger.warning(f" DB ID: {device_db_id}  IP  (device_ip)")

    # 4.2  (device_type)
    device_type_on_ads = device.device_type
    if not device_type_on_ads:
        logger.error(f" DB ID: {device_db_id}  (device_type)")
        return jsonify({"success": False, "message": ""}), 400

    # 5.  AdsPower API 
    try:
        adspower_api = get_adspower_api()
        #  device_ip_on_ads 
        logout_success, message = adspower_api.logout_device(adspower_account, device_name_on_ads, device_type_on_ads)
        logger.info(f"adspower_api.logout_device returned: success={logout_success}, message='{message}'")

        if logout_success is True:
            logger.info(f"AdsPower (: '{message}') DB ID: {device_db_id}")
            try:
                db.session.delete(device) # Delete the record
                db.session.commit()
                logger.info(f" DB ID: {device_db_id} ")
                final_message = message
                return jsonify({"success": True, "message": final_message})
            except Exception as e:
                db.session.rollback()
                logger.error(f"AdsPower/ {device_db_id} : {e}") 
                return jsonify({"success": False, "message": f"/: {e}"}), 500
        else:
            logger.error(f"AdsPower (DB ID: {device_db_id}): {message}")
            return jsonify({"success": False, "message": message or ""}), 500

    except Exception as e:
        logger.exception(f" logout_device  ( DB ID: {device_db_id}): {e}")
        return jsonify({"success": False, "message": f": {str(e)}"}), 500

# ===== API =====

def get_user_subscription_status(user_id):
    """"""
    subscription = Subscription.query.filter(
        Subscription.user_id == user_id,
        Subscription.end_date > datetime.utcnow()
    ).order_by(Subscription.end_date.desc()).first()
    
    # subscription_status = subscription.status if subscription else '' #  status
    is_active = bool(subscription) # 
    plan = subscription.plan if subscription else None
    end_date = subscription.end_date.isoformat() + 'Z' if subscription else None
    #  status 
    # return is_active, plan, end_date, subscription_status
    return is_active, plan, end_date
